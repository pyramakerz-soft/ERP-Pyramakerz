<div class="flex justify-between">
    <h1 class="primaryTxt font-semibold text-2xl leading-9"> {{ 'Print Name Tag' | translate }}</h1>
    <div class="flex justify-between items-center ">
        <app-search [keysArray]="keysArray" (searchEvent)="onSearchEvent($event)"></app-search>
    </div>
</div>

<div *ngIf="this.User_Data_After_Login.type === 'octa'" class="flex justify-between mt-5">
    <div class="w-[48%]">
        <label for="buses" class=" mb-2 text-sm font-medium text-gray-900">{{ 'Domains' | translate }}</label>
        <select id="buses" (change)="DomainIsChanged($event)"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  w-full p-2.5">
            <option [value]="null" disabled selected hidden>{{ 'Select a Domain' | translate }}</option>
            <option *ngFor="let domain of DomainData" [value]="domain.name">
                {{ domain.name }}
            </option>
        </select>
    </div>
    <div class="w-[48%]">
        <label for="buses" class="mb-2 text-sm font-medium text-gray-900"> {{ 'Buses' | translate }}</label>
        <select id="buses" (change)="getDataByBusId($event)"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  w-full p-2.5">
            <option [value]="-1" disabled selected hidden> {{ 'Select a Bus' | translate }}</option>
            <option *ngIf="BusData.length === 0" disabled selected>
                {{ 'No Data Found' | translate }}
            </option>
            <option *ngFor="let bus of BusData" [value]="bus.id">
                {{ bus.name }}
            </option>
        </select>
    </div>
</div>
<div *ngIf="this.User_Data_After_Login.type === 'employee'" class="mt-5">
    <div>
        <label for="buses" class="mb-2 text-sm font-medium text-gray-900"> {{ 'Buses' | translate }}</label>
        <select id="buses" (change)="getDataByBusId($event)" [(ngModel)]="busId"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5">
            <option [value]="-1" disabled selected hidden> {{ 'Select a Bus' | translate }}</option>
            <option *ngIf="BusData.length === 0" disabled selected>
                {{ 'No Data Found' | translate }}
            </option>
            <option *ngFor="let bus of BusData" [value]="bus.id">
                {{ bus.name }}
            </option>
        </select>
    </div>
</div>

<div *ngIf="busId!=-1">
    <div class="flex justify-end mt-3 space-x-4 rtl:space-x-reverse">
        <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()" 
             [title]="'Download PDF' | translate">
        <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()" 
             [title]="'Print' | translate">
    </div>

    <div class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD]">
        <table class="w-full tabe inset-0 bg-[#EBEBEB] text-left rtl:text-right text-[#6F6F6F]">
            <thead class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
                <tr>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'ID' | translate }}
                    </th>
                    <th
                        class="py-3 px-4 min-w-[120px] whitespace-nowrap  border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'School Name' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Grade' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Classes' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Student Name' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Categories' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Semester' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Exception' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Date From' | translate }}
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        {{ 'Date To' | translate }}
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- No Data Row -->
                <tr *ngIf="busStudentData.length === 0">
                    <td colspan="11"
                        class="bg-white px-4 py-2 h-[72px] text-center border-t border-gray-300 text-xs md:text-sm">
                        {{ 'No Data Found' | translate }}
                    </td>
                </tr>

                <!-- Data Rows -->
                <tr *ngFor="let row of busStudentData; let i = index"
                    [ngClass]="{'bg-[#F7F7F7]': i % 2 === 1, 'bg-white': i % 2 !== 1}"
                    class="border-t border-gray-300 text-xs md:text-sm">

                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.id }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.schoolName }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.gradeName }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.className }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.studentName }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.busCategoryName }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.semseterName }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        <i *ngIf="row.isException" class="secondaryTxt text-2xl fa-regular fa-square-check"></i>
                        <i *ngIf="!row.isException" class="text-[#BDBDBD] text-2xl fa-regular fa-square"></i>
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.exceptionFromDate }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.exceptionToDate }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<!-- Name Tag Template (Hidden until PDF/Print) -->
<div *ngIf="showPDF" #nameTagContainer 
     style="padding: 15px; font-family: Arial, sans-serif; background: white; width: 200mm; max-width: 200mm; margin: 0 auto; position: absolute; top: -9999px; left: -9999px; box-sizing: border-box;">

  <!-- Grid of Name Tags (2 columns) -->
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 5px; width: 100%; box-sizing: border-box;">
    
    <div *ngFor="let student of busStudentData" 
         style="border: 2px dashed #333; border-radius: 6px; padding: 10px; background: white; page-break-inside: avoid; min-height: 160px; display: flex; flex-direction: column; box-sizing: border-box; position: relative;">
      
      <!-- School Image in Top Left Corner - LARGER SIZE -->
      <div *ngIf="student.schoolImage" 
           style="position: absolute; top: 5px; left: 5px;">
        <img [src]="student.schoolImage" 
             alt="School Logo"
             style="width: 40px; height: 40px; object-fit: contain;"> <!-- Increased from 25px to 40px -->
      </div>

      <!-- School Name Header (Centered) -->
      <div style="text-align: center; margin-bottom: 8px; padding-left: 45px; padding-right: 45px;"> <!-- Increased padding to accommodate larger image -->
        <div style="font-size: 14px; font-weight: bold; color: #000; line-height: 1.2;">
          {{ student.schoolName }}
        </div>
      </div>

      <!-- Student Info -->
      <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center; margin-top: 5px;">
        <div style="margin-bottom: 6px;">
          <span style="font-size: 13px; font-weight: bold; color: #000;">Name: </span>
          <span style="font-size: 13px; font-weight: normal; color: #000;">{{ student.studentName }}</span>
        </div>
        <div style="margin-bottom: 6px;">
          <span style="font-size: 13px; font-weight: bold; color: #000;">Class: </span>
          <span style="font-size: 13px; font-weight: normal; color: #000;">{{ student.className }}</span>
        </div>
        <div style="margin-bottom: 6px;">
          <div style="font-size: 12px; font-weight: bold; color: #000;">{{ student.busCategoryName }}</div>
        </div>
      </div>

      <!-- Bus Info with Driver Number -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
        <div>
          <div style="font-size: 11px; font-weight: bold; color: #000;">Bus: {{ selectedBusName }}</div>
          <div *ngIf="student.driverNumber" style="font-size: 11px; font-weight: bold; color: #000;">
            Driver Number: {{ student.driverNumber }}
          </div>
        </div>
        <div style="font-size: 10px; color: #666; text-align: right;">
          <div>{{ student.gradeName }}</div>
        </div>
      </div>
    </div>
  </div>
</div>