<!-- Header Section -->
<div class="flex justify-between items-center">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <i class="fa-solid fa-chevron-left cursor-pointer rtl:rotate-180" (click)="goBack()"></i>
        <h1 class="primaryTxt font-semibold text-2xl leading-9">
            {{ currentSystem === 'zatca' ? 'ZATCA' : 'ETA' }} Invoice {{invoice.invoiceNumber}}
        </h1>
    </div>

    <div class="flex gap-4">
        <button (click)="printInvoice()" class="p-1 flex items-center gap-2 secondaryTxt text-3xl"
            [disabled]="isSubmitting">
            <i class="fa-solid fa-print"></i> </button>
<!-- Replace the existing send button in electronic-invoice-detail.component.html with this: -->
<button (click)="sendInvoice()" class="p-2 font-medium text-3xl rounded-lg flex items-center gap-2 secondaryTxt"
    [disabled]="isSubmitting" [ngClass]="{'opacity-50 cursor-not-allowed': isSubmitting}">
    <i *ngIf="!isSubmitting" class="fa-regular fa-paper-plane"></i>
    <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
</button>
    </div>
</div>

<!-- Invoice Header -->
<div class="text-center mb-8">
    <div class="mt-4 text-sm">
        <div class="flex justify-start gap-4 mb-4">
            <p><strong>Name:</strong> {{invoice.student}}</p>
            <p><strong>Address:</strong> {{invoice.studentAddress || 'N/A'}}</p>
        </div>
        <div class="flex justify-start gap-4">
            <p><strong>Date:</strong> {{formatDate(invoice.date) || 'N/A'}}</p>
            <p><strong>Number:</strong> {{invoice.invoiceNumber || 'N/A'}}</p>
            <p><strong>Status:</strong>
                <span *ngIf="invoice.isValid" style="color: #267C15;">
                    Sent
                </span>
                <span *ngIf="!invoice.isValid" style="color: red;">
                    Pending
                </span>
            </p>
        </div>
    </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="text-center py-10">
    <i class="fas fa-spinner fa-spin text-2xl"></i>
    <p>Loading invoice details...</p>
</div>

<!-- Invoice Content -->
<div *ngIf="invoice && !isLoading" class="">
    <!-- Products Table -->
    <div class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD]">
        <table class="w-full tabe inset-0 bg-[#EBEBEB] text-left text-[#6F6F6F]">
            <thead class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
                <tr>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Product </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Quantity </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Price </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Tax </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Total </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of invoice.inventoryDetails; let i = index"
                    [ngClass]="{ 'bg-[#F7F7F7]': i % 2 === 1, 'bg-white': i % 2 !== 1 }"
                    class="border-t border-gray-300 text-xs md:text-sm">
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        {{item.itemName}}
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        {{item.quantity}}
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        {{item.price}}
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        {{invoice.vatAmount}}
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        {{item.totalPrice}}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Invoice Summary -->
<div class="flex justify-start">
    <div class="w-full md:w-1/2 lg:w-1/3 border-t-2 border-gray-200 pt-4">
        <h3 class="text-lg font-semibold mb-4">Invoice Summary</h3>
        <div class="flex justify-between mb-2">
            <span class="font-medium">Sub total:</span>
            <span>{{invoice.total}}</span>
        </div>
        <div class="flex justify-between mb-2">
            <span class="font-medium">Taxes & Fees:</span>
            <span>{{invoice.vatAmount}}</span>
        </div>
        <div class="flex justify-between font-bold text-lg mt-4 pt-2 border-t">
            <span>Total:</span>
            <span class="text-[#089B41]">{{invoice.totalWithVat}}</span>
        </div>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="invoiceData" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'invoice_' + invoice.invoiceNumber"
            [Title]="'Simplified Tax Invoice'" [infoRows]="[
                { keyEn: 'Invoice Number: ' + invoice.invoiceNumber },
                { keyEn: 'Customer Name:'+  invoice.student || 'N/A' },
                { keyEn: 'Date:' + formatDate(invoice.date) || 'N/A' },
                { keyEn: 'VAT Registration Number:'+ '123456789900003' }
            ]" [tableHeaders]="['Product', 'Quantity', 'Price', 'Tax', 'Total']" [tableData]="getInvoiceTableData()"
            [PsNotes]="[
                { EnNote: 'Amount w/o Taxes: ' + (invoice.total) },
                { EnNote: 'VAT Amount: ' + (invoice.vatAmount) },
                { EnNote: 'Total with VAT: ' + (invoice.totalWithVat) }
            ]" #pdfPrint></app-pdf-print>
    </div>
</div>