<div class="">
    <div class="flex justify-between items-center">
        <h1 class="primaryTxt font-semibold text-2xl leading-9">Assignment</h1>
        <div class="flex justify-between items-center gap-4">
            <!-- Subject Filter -->
            <app-search [keysArray]="keysArray" (searchEvent)="onSearchEvent($event)"></app-search>

            <button (click)="openModal()"
                class="secondaryBorder secondaryTxt rounded-lg px-4 py-3 flex items-center justify-center gap-2">
                Create Assignment
            </button>
        </div>
    </div>

    <!-- Subject Filter with improved styling -->
    <div class="mt-6">
        <label for="subjectFilter" class="primaryTxt mb-2 text-sm font-medium">Subject</label>
        <div class="relative">
            <div (click)="toggleSubjectDropdown()"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg w-full p-2.5 cursor-pointer flex justify-between items-center">
                <span>{{ selectedSubjectName || 'Choose' }}</span>
                <i class="fas fa-chevron-down text-gray-400"></i>
            </div>

            <!-- Dropdown options as cards -->
            <div *ngIf="isSubjectDropdownOpen"
                class="absolute z-10 mt-1 w-full bg-white rounded-lg shadow-lg border border-gray-200 max-h-60 overflow-y-auto">
                <div *ngFor="let subject of subjects" (click)="selectSubject(subject)"
                    class="p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0">
                    {{ subject.name }}
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD] max-w-full">
        <table class="overflow-auto w-full bg-[#EBEBEB] text-left text-[#6F6F6F]">
            <thead class="bg-[##EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
                <tr>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Assignment Name
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Assignment Type
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Open Date
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Due Date
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Cut Off Date
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Employee Types
                    </th>
                    <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- No Data Row -->
                <tr *ngIf="filteredAssignments.length === 0">
                    <td colspan="7"
                        class="bg-white px-4 py-2 h-[72px] text-center border-t border-gray-300 text-xs md:text-sm">
                        No Data Found
                    </td>
                </tr>

                <!-- Data Rows -->
                <tr *ngFor="let row of filteredAssignments; let i = index"
                    [ngClass]="{'bg-[#F7F7F7]': i % 2 === 1, 'bg-white': i % 2 !== 1}"
                    class="border-t border-gray-300 text-xs md:text-sm">

                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.name }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.type }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.openDate | date }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.dueDate | date }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">{{ row.cutOffDate | date }}</td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        <div class="flex flex-wrap gap-2">
                            <div *ngFor="let class of row.classes" class="bg-gray-200 rounded-lg px-3 py-1 text-sm">
                                {{ class.name }} ({{ class.count }})
                            </div>
                        </div>
                    </td>
                    <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                        <div class="flex space-x-4">
                            <button>
                                <i class="fa-regular fa-trash-can" (click)="deleteAssignment(row.id)"></i>
                            </button>
<button (click)="editAssignment(row.id)">
    <i class="fa-solid fa-pencil"></i>
</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div> 

<!-- Modal -->
<div id="Add_Modal" class="fixed inset-0 z-50 justify-center items-center w-full h-full bg-black/50 hidden">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col">
        <!-- Modal Header -->
        <div class="sticky top-0 bg-white p-6 border-b flex justify-between items-center rounded-t-lg">
            <h1 class="text-xl md:text-2xl font-semibold">
                {{'Create Assignment' }}
            </h1>
            <button (click)="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
        </div>

        <!-- Modal Body - Scrollable Content -->
        <div class="overflow-y-auto p-6 space-y-6">
            <!-- Subject and Assignment Name -->
            <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                <div>
                    <label class="block mb-2 text-sm font-medium">Subject</label>
                    <div class="relative">
                        <div (click)="toggleModalSubjectDropdown()"
                            class="w-full p-3 border rounded-lg cursor-pointer flex justify-between items-center">
                            <span>{{ modalSelectedSubjectName || 'Choose' }}</span>
                            <i class="fas fa-chevron-down text-gray-400"></i>
                        </div>

                        <div *ngIf="isModalSubjectDropdownOpen"
                            class="absolute z-10 mt-1 w-full bg-white rounded-lg shadow-lg border border-gray-200 max-h-60 overflow-y-auto">
                            <div *ngFor="let subject of subjects" (click)="selectModalSubject(subject)"
                                class="p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0">
                                {{ subject.name }}
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium">Assignment Name</label>
                    <input type="text" class="w-full p-3 border rounded-lg" placeholder="Enter Assignment Name">
                </div>
            </div>

            <!-- Assignment Type and Mark -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2">
                    <label class="block mb-2 text-sm font-medium">Assignment Types</label>
                    <select class="w-full p-3 border rounded-lg">
                        <option disabled selected hidden value="">Choose</option>
                        <option value="textbook">Text Book</option>
                        <option value="fixed">Fixed Question</option>
                        <option value="randomized">Randomized</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium">Mark</label>
                    <input type="number" class="w-full p-3 border rounded-lg" placeholder="Mark">
                </div>
            </div>

            <!-- Dates -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div>
                    <label class="block mb-2 text-sm font-medium">Open Date</label>
                    <input type="date" class="w-full p-3 border rounded-lg">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium">Due Date</label>
                    <input type="date" class="w-full p-3 border rounded-lg">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium">Cut Off Date</label>
                    <input type="date" class="w-full p-3 border rounded-lg">
                </div>
            </div>

            <!-- Specific Students Toggle -->
            <div class="flex items-center">
                <input type="checkbox" id="specificStudents" class="w-5 h-5 mr-2" [(ngModel)]="isSpecificStudents">
                <label for="specificStudents" class="text-sm font-medium">Is The Assignment For specific
                    students?</label>
            </div>

            <!-- Class Done Section -->
            <div class="rounded-lg border">
                <!-- Closed State -->
                <div *ngIf="!isClassSelectorOpen" class="p-4 cursor-pointer" (click)="openClassSelector()">
                    <label class="block text-sm font-medium mb-1">Classes</label>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-500">
                            {{ selectedClasses.length > 0 ?
                            (selectedClasses.length + ' classes selected') :
                            'Select classes' }}
                        </span>
                        <i class="fas fa-chevron-down text-gray-400"></i>
                    </div>
                </div>

                <!-- Expanded State -->
                <div *ngIf="isClassSelectorOpen" class="p-4 space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="font-medium text-lg">Class Done ({{ totalSelectedStudents }})</h3>
                        <button (click)="closeClassSelector()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Class List View -->
                    <div *ngIf="!selectedClass" class="space-y-2">
                        <div *ngFor="let cls of availableClasses"
                            class="flex items-center justify-between p-3 bg-white rounded-lg border">
                            <div class="flex items-center">
                                <input type="checkbox" [id]="'class-'+cls.id" class="w-5 h-5 mr-3"
                                    [(ngModel)]="cls.selected" (change)="updateSelectedCount()">
                                <label [for]="'class-'+cls.id" class="cursor-pointer"
                                    (click)="selectClass(cls, $event)">
                                    {{ cls.name }} ({{ cls.students.length }})
                                </label>
                            </div>
                            <button class="text-gray-500 hover:text-gray-700" (click)="selectClass(cls, $event)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Student List View -->
                    <div *ngIf="selectedClass" class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="font-medium text-base">
                                <button class="text-gray-500 hover:text-gray-700 flex items-center"
                                    (click)="selectedClass = null">
                                    <i class="fas fa-chevron-left mr-2"></i>
                                    {{ selectedClass.name }} ({{ selectedClass.students.length }})
                                </button>
                            </h4>
                        </div>

                        <div class="flex items-center p-2 bg-white rounded border">
                            <input type="checkbox" id="selectAllStudents" class="w-5 h-5 mr-3"
                                [(ngModel)]="selectAllStudents" (change)="toggleSelectAllStudents()">
                            <label for="selectAllStudents" class="font-medium">Select All</label>
                        </div>

                        <div class="max-h-60 overflow-y-auto space-y-2">
                            <div *ngFor="let student of selectedClass.students"
                                class="flex items-center p-2 bg-white rounded border">
                                <input type="checkbox" [id]="'student-'+student.id" class="w-5 h-5 mr-3"
                                    [(ngModel)]="student.selected" (change)="updateSelectedCount()">
                                <label [for]="'student-'+student.id">{{ student.name }}</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="sticky bottom-0 bg-white p-6 border-t rounded-b-lg flex justify-end">
            <button
                class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                Save
            </button>
        </div>
    </div>
</div>
    </div>