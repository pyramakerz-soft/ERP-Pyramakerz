<div class="flex justify-between mb-3">
    <h1 class="primaryTxt font-semibold text-2xl leading-9">{{ 'Teacher Evaluation Report' | translate }}</h1>
</div>

<!-- Filters Section -->
<div class="my-5 flex flex-wrap md:flex-nowrap items-end space-x-0 md:space-x-6 space-y-4 md:space-y-0 mb-6">
    <!-- Department Select -->
    <div class="w-full md:w-1/4">
        <label for="department" class="block mb-2 text-sm font-medium text-gray-900">{{'Department'| translate }}</label>
        <select id="department" [(ngModel)]="filterParams.departmentId" (change)="onDepartmentChange()"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full">
            <option [ngValue]="null" selected>{{'Select'| translate }} {{'All'| translate }}</option>
            <option *ngFor="let department of departments" [value]="department.id"> 
                {{ department.name }} 
            </option>
        </select>
    </div>

    <!-- Employee Select -->
    <div class="w-full md:w-1/4">
        <label for="employee" class="block mb-2 text-sm font-medium text-gray-900">{{'Employee'| translate }}</label>
        <select id="employee" [(ngModel)]="filterParams.employeeId"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [disabled]="!filterParams.departmentId && departments.length > 0">
            <option [ngValue]="null" selected>{{'Select'| translate }} {{'All'| translate }}</option>
            <option *ngFor="let employee of employees" [value]="employee.id">
                {{ employee.en_name }} 
            </option>
        </select>
    </div>

    <!-- Start Date -->
    <div class="w-full md:w-1/4">
        <label for="fromDate" class="block mb-2 text-sm font-medium text-gray-900">{{'Start Date'| translate }}</label>
        <input id="fromDate" type="date" [(ngModel)]="filterParams.fromDate"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full">
    </div>

    <!-- End Date -->
    <div class="w-full md:w-1/4">
        <label for="toDate" class="block mb-2 text-sm font-medium text-gray-900">{{'End Date'| translate }}</label>
        <input id="toDate" type="date" [(ngModel)]="filterParams.toDate"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full">
    </div>

    <div class="w-full md:w-1/6 flex justify-end space-x-2 mt-4 md:mt-0">
        <button class="p-3 font-medium text-xl rounded-lg" (click)="generateReport()"
            [disabled]="!filterParams.fromDate || !filterParams.toDate" [ngClass]="{
                'bg-gray-100 text-gray-300': !filterParams.fromDate || !filterParams.toDate,
                'secondaryBg text-white': filterParams.fromDate && filterParams.toDate
            }">
            {{'View Report'| translate }}
        </button>
    </div>
</div>

<!-- Export Buttons -->
<div *ngIf="hasData && !isLoading" class="mt-4 flex items-center justify-end space-x-4">
    <button (click)="downloadAsPDF()" [disabled]="isExporting" >
    <img class="w-5 cursor-pointer" src="Icons/PDF.png"  title="Export to PDF">
    </button>
    <button (click)="printReport()" [disabled]="isExporting" >
    <img class="w-5 cursor-pointer" src="Icons/Print.png" title="Print Report">
    </button>
</div>

<!--     <button (click)="downloadAsPDF()" [disabled]="isExporting" 
 -->

<!-- Report Content (hidden, used for PDF generation) -->
<div #reportContent style="display: none;">
    <h1>Teacher Evaluation Report</h1>
    <h2>Performance Analysis</h2>
</div>

<!-- Chart Section -->
<div *ngIf="hasData && !isLoading" class="mt-8 bg-white p-6 rounded-lg shadow-md">
    <div class="chart-container" style="position: relative; height: 400px;">
        <canvas #chartCanvas id="evaluationChart"></canvas>
    </div>
</div>

<!-- Loading Indicator -->
<div *ngIf="isLoading" class="mt-8 bg-white p-6 rounded-lg shadow-md text-center">
    <i class="fas fa-spinner fa-spin text-2xl text-blue-600"></i>
    <p class="mt-2 text-gray-600">{{'Loading evaluation data...' | translate }}</p>
</div>

<!-- Exporting Indicator -->
<div *ngIf="isExporting" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
        <i class="fas fa-spinner fa-spin text-2xl text-blue-600 mb-2"></i>
        <p class="text-gray-700">{{'Generating report...' | translate }}</p>
    </div>
</div>