<div class="flex justify-between items-center mb-5">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <i class="fa-solid fa-chevron-left cursor-pointer" (click)="moveToTimeTable()"></i>
        <h1 class="font-semibold text-2xl leading-9">{{TimeTableName}}</h1>
    </div>

    <button (click)="Save()" class="rounded-lg secondaryBorder secondaryTxt px-4 py-3 flex items-center justify-center gap-2">
        <span *ngIf="!isLoading"> {{ 'Save' | translate }}</span>
        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
    </button>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse mb-4">
    <div class="w-[48%]">
        <label for="day" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Days' | translate }}</label>
        <select id="day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedDay" (change)="FilterTimeTable();">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }}  {{ 'Day' | translate }}</option>
            <option *ngFor="let day of days" [value]="day.id">
                {{ day.name }}
            </option>
            <option *ngIf="days.length === 0" disabled selected> {{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div class="w-[48%]">
        <label for="grade" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Grades' | translate }}</label>
        <select id="grade" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedGrade" (change)="FilterTimeTable();">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }} {{ 'Grade' | translate }}</option>
            <option *ngFor="let grade of grades" [value]="grade.id">
                {{ grade.name }}
            </option>
            <option *ngIf="grades.length === 0" disabled selected> {{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div *ngIf="SelectedDay!=0 || SelectedGrade!=0" class="rounded-full p-2 border-4" (click)="GetTimeTable()">
        <i class="fa-solid fa-rotate-left secondaryTxt text-2xl w-8 h-8 text-center hover:cursor-pointer rounded-full"></i>
    </div>
</div>

<div>
    <label class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Card Replace' | translate }}</label>
    <div class="p-2 border border-dashed border-blue-500 bg-blue-50 rounded min-h-[50px] flex space-x-1 rtl:space-x-reverse"
        (dragover)="onDragOver($event); autoScroll($event)" (drop)="onDropHolding($event)">
        <div *ngFor="let session of HoldingSessionsSession" draggable="true"
            (dragstart)="onDragStartHolding($event, session)"
            class="p-2 border border-gray-300 rounded mb-2 bg-white cursor-move w-[10%]">
            <div *ngFor="let subject of session.subjects" class="ml-2">
                <div>{{ subject.subjectName }}</div>
                <div class="text-gray-500 text-xs">{{ subject.teacherName }} </div>
            </div>
        </div>
        <div *ngIf="HoldingSessionsSession.length === 0" class="text-gray-500"> {{ 'No Session replaced' | translate }}</div>
    </div>
</div>

<div class="overflow-x-auto mt-4">
    <div *ngFor="let day of TimeTable" class="mb-10 border rounded shadow">
        <div class="bg-gray-300 text-center font-bold py-2">{{ day.dayName }}</div>

        <div *ngFor="let grade of day.grades" class="p-2">
            <div class="text-md font-semibold mb-1">{{ 'Grade' | translate }}: {{ grade.gradeName }}</div>

            <table class="table-auto w-full text-sm text-left rtl:text-right border-collapse border border-gray-300">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border p-2">{{ 'Class Name' | translate }}</th>
                        <th class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                             {{ 'Session' | translate }} {{ period + 1 }}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let classroom of grade.classrooms">
                        <td class="border p-2 font-medium">{{ classroom.classroomName }}</td>
                        <td class="border p-2" *ngFor="let session of classroom.sessions; let periodIndex = index"
                            draggable="true" (dragstart)="onDragStart($event, session)" (dragover)="onDragOver($event); autoScroll($event)"
                            (drop)="onDrop($event, session, day, periodIndex)"
                            class="border p-2 bg-gray-50 cursor-move">

                            <div *ngFor="let subject of session.subjects"
                                class="p-1 border border-gray-300 rounded mb-1 bg-white">
                                <div class="font-semibold text-blue-600">{{ subject.subjectName }}</div>
                                <div class="text-gray-500 text-xs">{{ subject.teacherName }}</div>
                            </div>

                            <div *ngIf="session.subjects.length === 0" class="text-gray-400">--</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>