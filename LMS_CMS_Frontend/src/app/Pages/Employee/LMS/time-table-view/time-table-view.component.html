<div class="flex justify-between items-center mb-5">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
            <i class="fa-solid fa-chevron-left cursor-pointer" 
            [class.rotate-180]="isRtl"(click)="moveToTimeTable()"></i>
        <h1 class="font-semibold text-2xl leading-9">
            {{TimeTableName | translate}}
        </h1>
    </div>
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <input type="date" [(ngModel)]="date" (change)="GetDutyByDate()" class="border p-2 rounded " />
        <button (click)="Replace()"
            class="rounded-lg secondaryBorder secondaryTxt px-4 py-3 flex items-center justify-center gap-2">
             {{ 'Edit' | translate }}
        </button>
    </div>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse mb-4">
    <div class="w-[48%]">
        <label for="day" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Days' | translate }}</label>
        <select id="day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedDay" (change)="FilterTimeTable();">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }}  {{ 'Day' | translate }}</option>
            <option *ngFor="let day of days" [value]="day.id">
                {{ day.name }}
            </option>
            <option *ngIf="days.length === 0" disabled selected> {{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div class="w-[48%]">
        <label for="grade" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Grades' | translate }}</label>
        <select id="grade" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedGrade" (change)="FilterTimeTable();">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }} {{ 'Grade' | translate }}</option>
            <option *ngFor="let grade of grades" [value]="grade.id">
                {{ grade.name }}
            </option>
            <option *ngIf="grades.length === 0" disabled selected> {{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div *ngIf="SelectedDay!=0 || SelectedGrade!=0" class="rounded-full p-2 border-4" (click)="GetTimeTable()">
        <i
            class="fa-solid fa-rotate-left secondaryTxt text-2xl w-8 h-8 text-center hover:cursor-pointer rounded-full"></i>
    </div>
</div>

<div class=" my-5 flex justify-end space-x-4 rtl:space-x-reverse">
    <img class="w-5 cursor-pointer" src="Icons/Excel.png" (click)="DownloadAsExcel()">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="openPrintModal()">
</div>

<div class="w-full overflow-x-auto">
  <div *ngFor="let day of TimeTable" class="min-w-max overflow-y-auto max-h-[80vh]">
    <div class="bg-gray-300 text-center text-xl font-bold py-4 mb-4 min-w-max sticky top-0 z-10">
      {{ day.dayName }}
    </div>

    <div *ngFor="let grade of day.grades" class="p-2">
      <div class="text-md font-semibold mb-1">
        {{ 'Grade' | translate }}: {{ grade.gradeName }}
      </div>

      <!-- Add min-w-[max-content] to prevent shrinking -->
        <table class="table-auto w-full min-w-max text-sm text-left border-collapse border border-gray-300">
        <thead class="bg-gray-100">
          <tr>
            <th class="border p-2 whitespace-nowrap">{{ 'Class Name' | translate }}</th>
            <th class="border p-2 whitespace-nowrap" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
              {{ 'Session' | translate }} {{ period + 1 }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let classroom of grade.classrooms">
            <td class="border p-2 font-medium">
              {{ classroom.classroomName }}
            </td>
            <td class="border p-2" *ngFor="let session of classroom.sessions">
              <div
                class="rounded-lg border-l-8 border-blue-500 bg-blue-50 px-4 py-2 text-lg font-medium text-gray-800 shadow mb-2 whitespace-normal">
                <div *ngFor="let subject of session.subjects">
                  <div class="text-gray-500 text-xs">{{ subject.subjectName }}</div>
                  <div class="text-gray-500 text-xs">{{ subject.teacherName }}</div>
                </div>
              </div>

              <div *ngIf="session.dutyTeacherName"
                class="rounded-lg border-l-8 border-red-500 bg-red-100 px-4 py-2 text-lg font-medium text-gray-800 shadow whitespace-normal">
                <div>{{ 'Duty' | translate }}</div>
                <div>{{ session.dutyTeacherName }}</div>
              </div>

              <div *ngIf="session.subjects.length === 0" class="text-gray-400">--</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>



<div id="Print_Modal" class="fixed inset-0 z-50 justify-center items-center w-full h-full bg-black/50 hidden">
    <div class="bg-white rounded-2xl p-12 w-[669px]">
        <div class="flex justify-between items-center">
            <h1 class="font-semibold text-2xl leading-9">Print Time Table</h1>
            <button (click)="closePrintModal()" type="button"
                class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-3 rounded-lg">X</button>
        </div>

        <div class="p-[16px_24px] mt-6 mb-4 bg-[#F7F7F7] rounded-3xl">
            <div class="flex flex-col mb-4">
                <label class="mb-2 primaryTxt" for="Type">Type</label>
                <select class="rounded-lg border border-solid border-gray-300 px-4 py-3 overflow-y-auto" id="Type"
                    [(ngModel)]="PrintType" (click)="GetTypes()">
                    <option *ngFor="let type of types" [value]="type">
                        {{ type | titlecase }}
                    </option>
                </select>
            </div>

            <div class="flex flex-col mb-4" *ngIf="PrintType=='Class'">
                <label class="mb-2 primaryTxt" for="Class">Class</label>
                <select class="rounded-lg border border-solid border-gray-300 px-4 py-3 overflow-y-auto" id="Class"
                    [(ngModel)]="SelectedClassId">
                    <option [value]="0" disabled selected hidden>Choose Class</option>
                    <option *ngFor="let class of classes" [value]="class.id">{{ class.name }}</option>
                    <option *ngIf="classes.length === 0" disabled selected>No Data Found</option>
                </select>
            </div>

            <div class="flex flex-col mb-4" *ngIf="PrintType=='Teacher'">
                <label class="mb-2 primaryTxt" for="Teacher">Teacher</label>
                <select class="rounded-lg border border-solid border-gray-300 px-4 py-3 overflow-y-auto" id="Teacher"
                    [(ngModel)]="SelectedTeacherId">
                    <option [value]="0" disabled selected hidden>Choose Teacher</option>
                    <option *ngFor="let t of Teachers" [value]="t.id">{{ t.en_name }}</option>
                    <option *ngIf="Teachers.length === 0" disabled selected>No Data Found</option>
                </select>
            </div>
        </div>

        <div class="flex justify-end">
            <button [disabled]="isLoading" class="secondaryBg text-white font-medium px-4 py-2 rounded-lg"
                (click)="Print()">
                <span *ngIf="!isLoading">Print</span>
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>
</div>


<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <div class="overflow-x-auto">
            <div class="bg-gray-300 text-center text-xl font-bold py-4 mb-4 print:mb-8 print:pb-4">
                {{ ClassName }}
            </div>

            <table class="table-auto w-full text-sm text-left border-collapse border border-gray-300">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border p-2">Day</th>
                        <th class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                            Session {{ period + 1 }}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let day of TimeTablePrint">
                        <td class="border p-2 font-medium">{{ day.dayName }}</td>

                        <td class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                            <ng-container *ngFor="let grade of day.grades">
                                <ng-container *ngFor="let classroom of grade.classrooms">
                                    <ng-container *ngIf="classroom.classroomName === ClassName">
                                        <ng-container *ngIf="classroom.sessions[period] as session">
                                            <div *ngFor="let subject of session.subjects">
                                                <div class="font-semibold text-blue-600">{{ subject.subjectName }}</div>
                                                <div class="text-gray-500 text-xs">
                                                    {{ subject.teacherName || 'No Teacher' }}
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div *ngIf="!classroom.sessions[period]" class="text-gray-400">--</div>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="DataTeacher" class="hidden">
        <div class="bg-gray-300 text-center text-xl font-bold py-4 mb-4 print:mb-8 print:pb-4">
            {{ TeacherName }}
        </div>
        <div class="overflow-x-auto">
            <div class="p-2">
                <table class="table-auto w-full text-sm text-left border-collapse border border-gray-300">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="border p-2">Day</th>
                            <th class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                                Session {{ period + 1 }}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let day of TimeTablePrint">
                            <td class="border p-2 font-medium">
                                {{ day.dayName }}
                            </td>
                            <td class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                                <ng-container *ngIf="day.sessions[period] as session">
                                    <div *ngFor="let subject of session.subjects">
                                        <div class="font-semibold text-blue-600">{{ subject.subjectName }}</div>
                                        <div class="text-gray-500 text-xs" *ngFor="let classroom of session.classes">
                                            {{ classroom.gradeName }} / {{ classroom.classroomName }}
                                        </div>
                                    </div>
                                </ng-container>
                                <div *ngIf="!day.sessions[period]" class="text-gray-400">--</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="All" class="hidden">
        <div class="overflow-x-auto">
            <div *ngFor="let day of TimeTable2" class="mb-10 border rounded shadow">
                <div class="bg-gray-300 text-center font-bold py-2">
                    {{ day.dayName }}
                </div>
                <div *ngFor="let grade of day.grades" class="p-2">
                    <div class="text-md font-semibold mb-1">
                        Grade: {{ grade.gradeName }}
                    </div>
                    <table class="table-auto w-full text-sm text-left border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border p-2">Class Name</th>
                                <th class="border p-2" *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                                    Session {{ period + 1 }}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let classroom of grade.classrooms">
                                <td class="border p-2 font-medium">
                                    {{ classroom.classroomName }}
                                </td>
                                <td class="border p-2 " *ngFor="let session of classroom.sessions">
                                    <div
                                        class="rounded-lg border-l-8 border-blue-500 bg-blue-50 px-4 py-2 text-lg font-medium text-gray-800 shadow mb-2">
                                        <div *ngFor="let subject of session.subjects">
                                            <div class="text-gray-500 text-xs">{{ subject.subjectName }}</div>
                                            <div class="text-gray-500 text-xs">{{ subject.teacherName }}</div>
                                        </div>
                                    </div>
                                    <!-- Duty Teacher -->
                                    <div *ngIf="session.dutyTeacherName"
                                        class="rounded-lg border-l-8 border-red-500 bg-red-100 px-4 py-2 text-lg font-medium text-gray-800 shadow">
                                        <div> {{ 'Duty' | translate }}</div>
                                        <div>{{ session.dutyTeacherName }}</div>
                                    </div>
                                    <div *ngIf="session.subjects.length === 0" class="text-gray-400">--</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [fileName]="'TimeTable'" [infoRows]="[
                { keyEn: 'Name: ' + TimeTableName },
            ]" [tableDataWithHeaderArray]="DataToPrint" #pdfComponentRef>
        </app-pdf-print>
    </div>
</div>