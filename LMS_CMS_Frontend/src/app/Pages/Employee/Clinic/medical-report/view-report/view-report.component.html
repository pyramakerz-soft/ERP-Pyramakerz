<div class="flex justify-between items-center">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <i class="fa-solid fa-chevron-left cursor-pointer rtl:rotate-180" (click)="goBack()"></i>
        <h1 class="primaryTxt font-semibold text-2xl leading-9">
             {{ 'Medical Report By' | translate }} {{ reportType === 'parent' ? ('Parent'|translate) : ('Doctor'|translate) }}
        </h1>
    </div>
</div>

<div *ngIf="isLoading" class="mt-6 text-center">
    <p> {{ 'Loading...' | translate }}</p>
</div>

<div *ngIf="error" class="mt-6 text-center text-red-500">
    <p>{{ error }}</p>
</div>

<div *ngIf="medicalHistory && !isLoading" class="mt-6">
    <!-- School Information Section (Doctor only) -->
    <div *ngIf="reportType === 'doctor'" class="flex flex-wrap justify-between gap-4 mb-6">
        <!-- Grade Box -->
        <div class="bg-[#EBEBEB] p-4 w-[32%]">
            <p class="font-semibold text-sm text-[#6F6F6F] mb-2"> {{ 'Grade' | translate }}</p>
            <p class="font-medium text-base text-[#1E1E1E]">
                {{ medicalHistory.grade || 'N/A' }}
            </p>
        </div>

        <!-- Class Box -->
        <div class="bg-[#EBEBEB] p-4 w-[32%]">
            <p class="font-semibold text-sm text-[#6F6F6F] mb-2"> {{ 'Class' | translate }}</p>
            <p class="font-medium text-base text-[#1E1E1E]">
                {{ medicalHistory.classRoom || 'N/A' }}
            </p>
        </div>

        <div class="bg-[#EBEBEB] p-4 w-[32%]">
            <p class="font-semibold text-sm text-[#6F6F6F] mb-2"> {{ 'Student' | translate }}</p>
            <p class="font-medium text-base text-[#1E1E1E]">
                {{ medicalHistory.student || 'N/A' }}
            </p>
        </div>
    </div>

    <!-- Date and Description Section -->
    <div class="flex flex-wrap justify-between gap-4 mb-6">
        <!-- Date Box -->
        <div [ngClass]="{'bg-[#2E3646]': reportType === 'doctor', 'bg-[#EBEBEB]': reportType === 'parent'}" 
             class="p-4 w-[49%]">
            <p [ngClass]="{'text-white': reportType === 'doctor', 'text-[#6F6F6F]': reportType === 'parent'}" 
               class="font-semibold text-sm mb-2">Date</p>
            <p [ngClass]="{'text-white': reportType === 'doctor', 'text-[#1E1E1E]': reportType === 'parent'}" 
               class="font-medium text-base">
                {{ medicalHistory.insertedAt | date: 'd MMM y' }}
            </p>
        </div>
    
<!-- Description Box -->
<div class="bg-[#EBEBEB] p-4 w-[49%]">
    <p class="font-semibold text-sm text-[#6F6F6F] mb-2">{{ 'Description' | translate }}</p>
    <p class="font-medium text-base text-[#1E1E1E] whitespace-pre-wrap break-words max-h-32 overflow-y-auto">
        {{ medicalHistory.details || 'No description provided' }}
    </p>
</div>

    <!-- Permanent Drug Section (Parent only) -->
    <div *ngIf="reportType === 'parent' && medicalHistory.permanentDrug" class="bg-[#EBEBEB] p-4 rounded-lg mb-6">
        <p class="font-semibold text-sm text-[#6F6F6F] mb-2">  {{ 'Permanent Drug' | translate }}</p>
        <p class="font-medium text-base text-[#1E1E1E]">
            {{ medicalHistory.permanentDrug }}
        </p>
    </div>

    <!-- Attached Files Section -->
    <div class="bg-[#EBEBEB] p-6 rounded-lg shadow-sm">
        <h2 class="font-semibold text-lg text-[#1E1E1E] mb-4"> {{ 'Attached' | translate }}</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- First Report Box -->
            <div *ngIf="hasValidFile(medicalHistory.firstReport)" class="bg-white p-4 rounded-lg shadow-sm relative">
                <div class="flex items-start space-x-3">
                    <div class="w-10 h-10 bg-[#EBEBEB] rounded-full flex items-center justify-center">
                        <i class="fa-regular fa-file text-[#6F6F6F]"></i>
                    </div>
                    <div>
                        <p class="font-medium text-base text-[#1E1E1E] mb-2">
                            {{ getFileName(medicalHistory.firstReport) }}
                        </p>
                        <p class="font-medium text-sm text-[#6F6F6F] mb-1"> {{ 'File Name' | translate }}</p>
                        <a [href]="medicalHistory.firstReport" target="_blank"
                            class="text-[#A020F0] font-medium text-sm hover:underline">
                             {{ 'Click to' | translate }} {{ 'view' | translate }}
                        </a>
                    </div>
                </div>
            </div>

            <!-- Second Report Box -->
            <div *ngIf="hasValidFile(medicalHistory.secReport)" class="bg-white p-4 rounded-lg shadow-sm relative">
                <div class="flex items-start space-x-3">
                    <div class="w-10 h-10 bg-[#EBEBEB] rounded-full flex items-center justify-center">
                        <i class="fa-regular fa-file text-[#6F6F6F]"></i>
                    </div>
                    <div>
                        <p class="font-medium text-base text-[#1E1E1E] mb-2">
                            {{ getFileName(medicalHistory.secReport) }}
                        </p>
                        <p class="font-medium text-sm text-[#6F6F6F] mb-1">{{ 'File Name' | translate }}</p>
                        <a [href]="medicalHistory.secReport" target="_blank"
                            class="text-[#A020F0] font-medium text-sm hover:underline">
                             {{ 'Click to' | translate }} {{ 'view' | translate }}
                        </a>
                    </div>
                </div>
            </div>

            <!-- No Files Message -->
            <div *ngIf="!hasValidFile(medicalHistory.firstReport) && !hasValidFile(medicalHistory.secReport)"
                class="col-span-2 text-center py-4">
                <p class="text-[#6F6F6F] font-medium"> {{ 'No attached files' | translate }}</p>
            </div>
        </div>
    </div>
</div>