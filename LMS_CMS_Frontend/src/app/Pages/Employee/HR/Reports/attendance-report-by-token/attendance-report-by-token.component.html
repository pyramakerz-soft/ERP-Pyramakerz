<div class="flex justify-between items-center mb-5">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <h1 class="primaryTxt font-semibold text-2xl leading-9"> {{ 'Attendance' | translate }} </h1>
    </div>
</div>

<div class="flex flex-wrap justify-start items-center gap-2 rtl:space-x-reverse">
    <div class="w-[30%]">
        <label for="Month" class="block mb-2 text-sm font-medium text-gray-900">
            {{ 'Month' | translate }}
        </label>
        <input id="Month" type="month" [(ngModel)]="selectedMonth" required
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            (change)="onDateChange(); IsShowTabls = false;">
    </div>

    <div class="mt-7 ml-2">
        <button class="p-3 font-medium text-xl rounded-lg" [disabled]="!month || !year " (click)="Apply()"
            [ngClass]="{ 'bg-gray-100 text-gray-300':!month || !year , 'secondaryBg text-white': month && year }">
            {{ 'View' | translate }}
        </button>
    </div>
</div>

<div *ngIf="IsShowTabls" class="my-5 flex justify-end space-x-4 rtl:space-x-reverse">
    <img class="w-5 cursor-pointer" src="Icons/Excel.png" (click)="DownloadAsExcel()">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()">
</div>

<div *ngIf="IsShowTabls" class="flex justify-between items-start space-x-2 rtl:space-x-reverse">
    <div class="w-full">
        <div class="mt-5 rounded-2xl border border-[#BDBDBD]">
            <!-- Fixed height + vertical scroll -->
            <div class="max-h-[70vh] overflow-y-auto overflow-x-auto rounded-2xl">
                <table class="w-full inset-0 bg-[#EBEBEB] text-left rtl:text-right text-[#6F6F6F]">
                    <thead
                        class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0 sticky top-0 z-10">
                        <tr>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Day' | translate }}
                            </th>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Day Status' | translate }}
                            </th>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Total Working Hours' | translate }}
                            </th>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Leave Request in Hours' | translate }}
                            </th>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Overtime in Hours' | translate }}
                            </th>
                            <th
                                class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                                {{ 'Deduction in Hours' | translate }}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- No Data Row -->
                        <tr *ngIf="monthlyAttendenc.length === 0">
                            <td colspan="6"
                                class="bg-white px-4 py-2 h-[72px] text-center border-t border-gray-300 text-xs md:text-sm">
                                {{ 'No Data Found' | translate }}
                            </td>
                        </tr>

                        <!-- Data Rows -->
                        <tr *ngFor="let row of monthlyAttendenc; let i = index"
                            [ngClass]="{ 'bg-[#F7F7F7]': i % 2 === 1, 'bg-white': i % 2 !== 1 }"
                            class="border-t border-gray-300 text-xs md:text-sm">
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.day }}
                            </td>
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.dayStatusName }}
                            </td>
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.workingHours }} : {{ row.workingMinutes }}
                            </td>
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.leaveRequestHours }} : {{ row.leaveRequestMinutes }}
                            </td>
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.overtimeHours }} : {{ row.overtimeMinutes }}
                            </td>
                            <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ row.deductionHours }} : {{ row.deductionMinutes }}
                            </td>
                        </tr>
                        <!-- Total Row -->
                        <tr *ngIf="monthlyAttendenc.length > 0" class="bg-gray-100 font-semibold text-sm">
                            <td colspan="3" class="py-4 px-4 border border-[#EAECF0] border-t-0 border-l-0 text-center">
                                {{ 'Total' | translate }}
                            </td>
                            <td class="py-4 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ getTotal('leaveRequestHours', 'leaveRequestMinutes') }}
                            </td>
                            <td class="py-4 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ getTotal('overtimeHours', 'overtimeMinutes') }}
                            </td>
                            <td class="py-4 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                                {{ getTotal('deductionHours', 'deductionMinutes') }}
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'Attendance Report'" 
                 [infoRows]="[
                { keyEn: 'Month: ' + this.month + '/' +this.year,  keyAr: this.month+ '/' +this.year + ': شهر' },
                { keyEn: 'Employee: ' + this.SelectedEmpName,     keyAr:  'الموظف : ' + this.SelectedArName }
                ]" 
                [tableHeaders]="['Day', 'Day Status', 'Total Working Hours', 'Leave Request in Hours', 'Overtime in Hours', 'Deduction in Hours']" 
                [tableData]="tableDataForPDF" #pdfComponentRef>
        </app-pdf-print>
    </div>
</div>