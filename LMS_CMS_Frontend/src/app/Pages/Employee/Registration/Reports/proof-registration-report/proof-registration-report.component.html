<div class="flex justify-between mb-3">
    <h1 class="primaryTxt font-semibold text-2xl leading-9">  {{ 'Proof Registration Report' | translate }}</h1>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse">
    <div class="w-[49%]">
        <label for="School1" class="block mb-2 text-sm font-medium text-gray-900">{{ 'School' | translate }}</label>
        <select id="School1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedSchoolId" (change)="onSchoolChange()">
            <option value=0 disabled selected hidden>{{ 'Select' | translate }} {{ 'School' | translate }}</option>
            <option *ngFor="let stu of schools" [value]="stu.id">
                {{ stu.name }}
            </option>
            <option *ngIf="schools.length === 0" disabled selected>{{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div class="w-[49%]">
        <label for="Year" class="block mb-2 text-sm font-medium text-gray-900">{{ 'Year' | translate }}</label>
        <select id="Year" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedYearId" (change)="onYearChange()" [disabled]="!SelectedSchoolId">
            <option value=0 disabled selected hidden>{{ 'Select' | translate }} {{ 'Year' | translate }} </option>
            <option *ngFor="let ac of academicYears" [value]="ac.id">
                {{ ac.name }}
            </option>
            <option *ngIf="academicYears.length === 0" value=0 disabled selected>
                {{ SelectedSchoolId ? 'No Academic Years Found' : 'Select School First' | translate }}
            </option>
        </select>
    </div>
</div>

<div class="flex justify-start items-center mt-2 rtl:space-x-reverse space-x-4">
    <div class="w-[80%]">
        <label for="Student" class="block mb-2 text-sm font-medium text-gray-900">{{ 'Student' | translate }}</label>
        <ng-container *ngIf="!isSearching">
            <select id="Student" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="SelectedStudentId"
                [disabled]="!SelectedSchoolId || !SelectedYearId">
                <option value=0 disabled selected hidden>{{ 'Select' | translate }} {{ 'Student' | translate }}</option>
                <option *ngFor="let ac of filteredStudents" [value]="ac.id">
                    {{ ac.en_name }}
                </option>
                <option *ngIf="filteredStudents.length === 0" value=0 disabled selected>
                    {{ SelectedYearId ? 'No Students Found' : 'Select Year First' | translate }}
                </option>
            </select>
        </ng-container>
        <ng-container *ngIf="isSearching">
            <input type="text" id="StudentSearch"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="searchQuery" (input)="searchStudents()" placeholder="{{ 'Search by Name' | translate }}">
        </ng-container>
    </div>

    <div class="mt-7 ml-2">
        <button class="p-3 font-medium text-xl rounded-lg " (click)="ViewReport()"
            [disabled]="!SelectedSchoolId || !SelectedStudentId || !SelectedYearId"
            [ngClass]="{ 'bg-gray-100 text-gray-300': !SelectedSchoolId || !SelectedStudentId || !SelectedYearId, 'secondaryBg text-white': SelectedSchoolId && SelectedStudentId && SelectedYearId }">
            {{'View Report' | translate}}</button>
    </div>
</div>

<div *ngIf="showTable" class="mt-5 flex justify-end space-x-4 rtl:space-x-reverse items-center">
    <img class="w-5 cursor-pointer" src="https://d393tpgdl2mqkp.cloudfront.net/public/Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="https://d393tpgdl2mqkp.cloudfront.net/public/Icons/Print.png" (click)="Print()">
</div>

<!-- Main Page Display - Now matches PDF exactly -->
<div *ngIf="showTable" class="mt-5 bg-white p-8 text-sm font-sans" [dir]="direction">
    <!-- Header Section - Matches PDF -->
    <div class="flex justify-between items-center mb-6">
        <div class="w-[40%]">
            <p class="text-base font-semibold mb-1">{{school.reportHeaderOneEn}}</p>
            <p class="text-sm">{{school.reportHeaderTwoEn}}</p>
        </div>
        
        <div class="flex justify-center w-[15%]">
            <img *ngIf="school.reportImage" [src]="school.reportImage" 
                 style="max-width: 120px; max-height: 120px; width: auto; height: auto;" />
        </div>
        
        <div class="w-[40%]" [class]="direction === 'rtl' ? 'text-left' : 'text-right'">
            <p class="text-base font-semibold mb-1">{{school.reportHeaderOneAr}}</p>
            <p class="text-sm">{{school.reportHeaderTwoAr}}</p>
        </div>
    </div>

    <!-- Title - Matches PDF -->
    <div class="my-10 flex justify-center">
        <h1 class="text-3xl font-bold tracking-wide">Identifier Letter</h1>
    </div>

    <!-- Bilingual Content - Matches PDF structure -->
    <div class="my-10 space-y-4" dir="ltr">
        <!-- Date -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Date :</strong> {{CurrentDate}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>التاريخ :</strong>{{ArabicCurrentDate}} </div>
            </div>
        </div>

        <!-- Dear Sirs -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Dear Sirs ,</strong></div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>, تحية طيبة وبعد</strong></div>
            </div>
        </div>

        <!-- Student Name -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>This is to certify that Student /</strong>{{getStudentName()}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>نفيدكم بأن الطالب/ة /</strong>{{getStudentArabicName()}} </div>
            </div>
        </div>

        <!-- Nationality -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8">{{getNationality()}}<strong> Nationality</strong></div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"> <strong>تحمل الجنسية /</strong> {{getArabicNationality()}}</div>
            </div>
        </div>

        <!-- Identity Number -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>and identity No. </strong>{{DataToPrint?.student?.nationalID || 'N/A'}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">{{DataToPrint?.student?.nationalID || 'غير متوفر'}} <strong>/ هوية رقم</strong></div>
            </div>
        </div>

        <!-- Passport Number -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Hold Passport No. </strong>{{getPassportNo()}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">{{getPassportNo()}} <strong>/ و جواز سفر رقم</strong></div>
            </div>
        </div>

        <!-- Registration -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Is registered in this school this year </strong>{{DataToPrint?.student?.startAcademicYearName}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">{{DataToPrint?.student?.startAcademicYearName}} <strong>مقيدة لدينا من للعام الدراسي الحالى</strong></div>
            </div>
        </div>

        <!-- Certificate Purpose -->
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8">And he/she was given this certificate to be presented to whom it may concern, without bearing any responsibility on the part of the school.</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">.وقد أعطيت له هذه الإفادة لتقديمها لمن يهمه الأمر دون أدنى مسؤولية على المدرسة</div>
            </div>
        </div>
    </div>

    <!-- Footer - Matches PDF -->
    <div class="mt-12 space-y-4" dir="ltr">
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Best Regards ,</strong></div>
                <div class="text-lg leading-8"><strong>Administration</strong></div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>وتقبلوا فائق التحية والاحترام</strong></div>
                <div class="text-lg leading-8"><strong>ادارة المدرسة</strong></div>
            </div>
        </div>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'Proof of Registration'" [Title]="'Identifier Letter'"
        [infoRows]="[
        {
          keyEn: 'Date : ' + CurrentDate,
          keyAr: 'التاريخ: ' + ArabicCurrentDate
        },
        {
          keyEn: 'Dear Sirs ,',
          keyAr: 'تحية طيبة وبعد'
        },
        {
          keyEn: 'This is to certify that Student / ' + getStudentName(),
          keyAr: 'نفيدكم بأن الطالب/ة / ' + getStudentArabicName()
        },
        {
          keyEn: getNationality() + ' Nationality',
          keyAr: 'تحمل الجنسية : ' + getArabicNationality()
        },
        {
          keyEn: 'and identity No. ' + (DataToPrint?.student?.nationalID || '-'),
          keyAr: (DataToPrint?.student?.nationalID || '-') + ' : هوية رقم'
        },
        {
          keyEn: 'Hold Passport No.  ' + getPassportNo(),
          keyAr: getPassportNo() + ' : و جواز سفر رقم'
        },
        {
          keyEn: 'Is registered in this school this year: ' + DataToPrint?.student?.startAcademicYearName,
          keyAr: DataToPrint?.student?.startAcademicYearName + ' : مقيدة لدينا من للعام الدراسي الحالى '
        },
        {
          keyEn: 'And he/she was given this certificate to be presented to whom it may concern, without bearing any responsibility on the part of the school.',
          keyAr: '. وقد أعطيت له هذه الإفادة لتقديمها لمن يهمه الأمر دون أدنى مسؤولية على المدرسة'
        }
      ]" 
      [PsNotes]="[
        {
            EnNote: 'Best Regards ,',
            ArNote: 'وتقبلوا فائق التحية والاحترام'
        },
        {
            EnNote: 'Administration',
            ArNote: 'ادارة المدرسة'
        }
      ]" #pdfComponentRef></app-pdf-print>
    </div>
</div>