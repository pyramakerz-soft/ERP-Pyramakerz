<div class="flex justify-between mb-3">
    <h1 class="primaryTxt font-semibold text-2xl leading-9">{{ 'Academic Sequential Report' | translate }}</h1>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse">
    <div class="w-[49%]">
        <label for="School1" class="block mb-2 text-sm font-medium text-gray-900">{{ 'School' | translate }}</label>
        <select id="School1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedSchoolId" (change)="getAllStudents()">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }} {{ 'School' | translate }}</option>
            <option *ngFor="let stu of schools" [value]="stu.id">
                {{ stu.name }}
            </option>
            <option *ngIf="schools.length === 0" disabled selected>{{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div class="w-[49%]">
        <label for="Student" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Student' | translate }}</label>
        <ng-container *ngIf="!isSearching">
            <select id="Student" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="SelectedStudentId" [disabled]="!SelectedSchoolId">
                <option value="0" disabled selected hidden>{{ 'Select' | translate }} {{ 'Student' | translate }}
                </option>
                <option *ngFor="let ac of filteredStudents" [value]="ac.id">
                    {{ ac.en_name }}
                </option>
                <option *ngIf="filteredStudents.length === 0" disabled selected>{{ 'No Data Found' | translate }}
                </option>
            </select>
        </ng-container>
        <ng-container *ngIf="isSearching">
            <input type="text" id="StudentSearch"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="searchQuery" (input)="searchStudents()" placeholder=" {{ 'Search by Name' | translate }}">
        </ng-container>
    </div>
    <div class="mt-7 ml-2">
        <button class="p-3 font-medium text-xl rounded-lg" (click)="ViewReport()"
            [disabled]="!SelectedSchoolId || !SelectedStudentId "
            [ngClass]="{ 'bg-gray-100 text-gray-300': !SelectedSchoolId || !SelectedStudentId , 'secondaryBg text-white': SelectedSchoolId && SelectedStudentId}">
            {{ 'View Report' | translate }}</button>
    </div>
</div>

<div *ngIf="showTable" class="mt-5 flex justify-end space-x-4 rtl:space-x-reverse">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()">
</div>

<!-- Main Page Display - Now matches PDF exactly -->
<div *ngIf="showTable" class="mt-5 bg-white p-8 text-sm font-sans" [dir]="direction">
    <!-- Header Section - Matches PDF -->
    <div class="flex justify-between items-center mb-6">
        <div class="w-[40%]">
            <p class="text-base font-semibold mb-1">{{school.reportHeaderOneEn}}</p>
            <p class="text-sm">{{school.reportHeaderTwoEn}}</p>
        </div>
        
        <div class="flex justify-center w-[15%]">
            <img *ngIf="school.reportImage" [src]="school.reportImage" 
                 style="max-width: 120px; max-height: 120px; width: auto; height: auto;" />
        </div>
        
        <div class="w-[40%]" [class]="direction === 'rtl' ? 'text-left' : 'text-right'">
            <p class="text-base font-semibold mb-1">{{school.reportHeaderOneAr}}</p>
            <p class="text-sm">{{school.reportHeaderTwoAr}}</p>
        </div>
    </div>

    <!-- Title - Matches PDF -->
    <div class="my-10 flex justify-center">
        <h1 class="text-3xl font-bold tracking-wide">School Leaving Certificate</h1>
    </div>

    <!-- Bilingual Content - Matches PDF structure -->
    <div class="my-10 space-y-4" dir="ltr">
        <div class="flex justify-between">
            <!-- English content (always left) -->
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Date:</strong> {{CurrentDate}}</div>
            </div>
            <!-- Arabic content (always right) -->
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>التاريخ:</strong> {{ArabicCurrentDate}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Student's Name:</strong> {{DataToPrint?.student?.en_name || SelectedStudent.en_name}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>اسم الطالب/ة:</strong> {{DataToPrint?.student?.ar_name || SelectedStudent.ar_name}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Date Of Birth:</strong> {{DataToPrint?.student?.dateOfBirth}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>تاريخ الميلاد:</strong> {{DataToPrint?.student?.dateOfBirth}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Nationality:</strong> {{DataToPrint?.student?.nationalityEnName}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>الجنسية:</strong> {{DataToPrint?.student?.nationalityArName}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Passport No:</strong> {{DataToPrint?.student?.passportNo || 'N/A'}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>رقم جواز السفر:</strong> {{DataToPrint?.student?.passportNo || 'غير متوفر'}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Date of Admission:</strong> {{ formatDate(DataToPrint?.student?.insertedAt, 'ltr') || 'N/A'}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>تاريخ الالتحاق بالمدرسة:</strong> {{ formatDate(DataToPrint?.student?.insertedAt, 'rtl') || 'غير متوفر'}}</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>Current Grade:</strong> {{DataToPrint?.student?.currentGradeName || 'N/A'}}</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">{{DataToPrint?.student?.currentGradeName || 'غير متوفر'}} <strong>:الصف الدراسي الحالي</strong></div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8">--------------------------</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8">--------------------------</div>
            </div>
        </div>

        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8 mt-4">{{ school.name }} School Certificates <br> that the student mentioned above has been a student of the school and has completed the grade/s as shown below.</div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8 mt-4">{{ school.name }} نشهد مدارس <br> أن الطالب المذكور أعلاه هو أحد الطلاب المنتظمين في المدرسة وقد أنهى الصفوف الدراسية علي النحو الموضح أدناه </div>
            </div>
        </div>
    </div>

    <!-- Academic Progress Table - Matches PDF structure -->
    <div class="mt-8 overflow-x-auto pdf-table-container">
        <table class="w-full border border-gray-300 table-fixed">
            <colgroup>
                <col style="width: 33%">
                <col style="width: 33%">
                <col style="width: 34%">
            </colgroup>
            <thead class="bg-gray-100">
                <tr>
                    <th class="py-3 px-4 border border-gray-300 font-semibold text-sm">School</th>
                    <th class="py-3 px-4 border border-gray-300 font-semibold text-sm">Grade</th>
                    <th class="py-3 px-4 border border-gray-300 font-semibold text-sm">Academic Year</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="TableData.length > 0" class="border-t border-gray-300">
                    <td class="py-3 px-4 border border-gray-300 text-center align-top" [attr.rowspan]="TableData.length">{{school.name}}</td>
                    <td class="py-3 px-4 border border-gray-300 text-center">{{TableData[0].Grade}}</td>
                    <td class="py-3 px-4 border border-gray-300 text-center">{{TableData[0].Academic_Year}}</td>
                </tr>
                <tr *ngFor="let grade of TableData | slice:1" class="border-t border-gray-300">
                    <td class="py-3 px-4 border border-gray-300 text-center">{{grade.Grade}}</td>
                    <td class="py-3 px-4 border border-gray-300 text-center">{{grade.Academic_Year}}</td>
                </tr>
                <tr *ngIf="TableData.length === 0">
                    <td colspan="3" class="py-3 px-4 border border-gray-300 text-center">No academic records found</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Footer - Matches PDF -->
    <div class="mt-12 space-y-4" dir="ltr">
        <div class="flex justify-between">
            <div class="w-1/2 text-left">
                <div class="text-lg leading-8"><strong>ادارة المدرسة</strong></div>
            </div>
            <div class="w-1/2 text-right">
                <div class="text-lg leading-8"><strong>الختم</strong></div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden PDF content (unchanged) -->
<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'School Leaving Certificate'"
            [Title]="'School Leaving Certificate'" [infoRows]="[
        {
          keyEn: 'Student`s Name : ' + this.DataToPrint.student.en_name,
          keyAr: 'اسم الطالب : ' + this.DataToPrint.student.ar_name
        },
        {
          keyEn: 'Date Of Birth : ' + this.DataToPrint.student.dateOfBirth,
          keyAr: ' تاريخ الميلاد : '  + this.DataToPrint.student.dateOfBirth
        },
        {
          keyEn: 'Nationality :  ' + this.DataToPrint.student.nationalityEnName,
          keyAr: ' الجنسية :' + this.DataToPrint.student.nationalityArName
        },
        {
            keyEn: ' Passport No : ' + (this.DataToPrint.student.passportNo || '-'),
            keyAr:  (this.DataToPrint.student.passportNo || '-') + ' : رقم جواز السفر'
          },
        {
          keyEn: 'Date of Admission :  ' + this.formatDate(this.DataToPrint.student.insertedAt, 'ltr'),
          keyAr: ' تاريخ الالتحاق بالمدرسة  : ' + this.formatDate(this.DataToPrint.student.insertedAt, 'rtl')
        },
        {
            keyEn: 'Current Grade :  ' + this.DataToPrint.student.currentGradeName,
            keyAr:  this.DataToPrint.student.currentGradeName + ' : الصف الدراسي الحالى'
          },
        {
            keyEn: '--------------------------',
            keyAr: '--------------------------'
          },
        {
          keyEn: this.DataToPrint.school.name + ' school Certificates',
          keyAr: this.DataToPrint.school.name + ' تشهد' 
        },
        {
          keyEn: 'that the student mentioned above has been a student of the school and has completed the grade/s as shown below.',
          keyAr: ' أن الطالب المذكور أعلاه هو أحد الطلاب المنتظمين في المدرسة وقد أنهى الصفوف الدراسية علي النحو الموضح أدناه '  
        }
      ]" [tableHeaders]="['School', 'Grade', 'Academic_Year']" [tableData]="getTableDataForPDF()" [PsNotes]="[
        {
            EnNote: 'ادارة المدرسة',
            ArNote: 'الختم'
        },
      ]" #pdfComponentRef>
        </app-pdf-print>
    </div>
</div>