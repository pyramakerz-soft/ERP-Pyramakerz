<div class="flex justify-between mb-3">
    <h1 class="primaryTxt font-semibold text-2xl leading-9"> {{ 'Transferred From Kindergarten' | translate }}</h1>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse">
    <div class="w-[49%]">
        <label for="School1" class="block mb-2 text-sm font-medium text-gray-900">{{ 'School' | translate }}</label>
        <select id="School1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedSchoolId" (change)="onSchoolChange()">
            <option value=0 disabled selected hidden>{{ 'Select' | translate }} {{ 'School' | translate }}</option>
            <option *ngFor="let stu of schools" [value]="stu.id">
                {{ stu.name }}
            </option>
            <option *ngIf="schools.length === 0" disabled selected>{{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div class="w-[49%]">
        <label for="Year" class="block mb-2 text-sm font-medium text-gray-900">{{ 'Year' | translate }}</label>
        <select id="Year" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedYearId" (change)="onYearChange()" [disabled]="!SelectedSchoolId">
            <option value=0 disabled selected hidden>{{ 'Select' | translate }} {{ 'Year' | translate }}</option>
            <option *ngFor="let ac of academicYears" [value]="ac.id">
                {{ ac.name }}
            </option>
            <option *ngIf="academicYears.length === 0" disabled selected>{{ 'No Data Found' | translate }}</option>
        </select>
    </div>
</div>

<div class="flex justify-start items-center mt-2 space-x-4 rtl:space-x-reverse">
    <div class="w-[80%]">
        <label for="Student" class="block mb-2 text-sm font-medium text-gray-900">{{ 'Student' | translate }}</label>
        <ng-container *ngIf="!isSearching">
            <select id="Student" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="SelectedStudentId" (change)="onStudentChange()"
                [disabled]="!SelectedSchoolId || !SelectedYearId">
                <option value="0" disabled selected hidden>{{ 'Select' | translate }} {{ 'Student' | translate }}</option>
                <option *ngFor="let ac of filteredStudents" [value]="ac.id">
                    {{ ac.en_name }}
                </option>
                <option *ngIf="filteredStudents.length === 0" disabled selected>{{ 'No Data Found' | translate }}</option>
            </select>
        </ng-container>
        <ng-container *ngIf="isSearching">
            <input type="text" id="StudentSearch"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
                [(ngModel)]="searchQuery" (input)="searchStudents()" placeholder="{{ 'Search by Name' | translate }}">
        </ng-container>
    </div>

    <div class="mt-7 ml-2">
        <button class="p-3 font-medium text-xl rounded-lg" (click)="ViewReport()"
            [disabled]="!showViewReportBtn || isLoading"
            [ngClass]="{ 'bg-gray-100 text-gray-300': !showViewReportBtn || isLoading, 'secondaryBg text-white': showViewReportBtn && !isLoading }">
             {{ 'View Report' | translate }}</button>
    </div>
</div>

<div *ngIf="showTable" class="mt-5 flex justify-end space-x-4 rtl:space-x-reverse">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()">
</div>

<div *ngIf="showTable" class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD]">
    <table class="w-full tabe inset-0 bg-[#EBEBEB] text-left rtl:text-right text-[#6F6F6F]">
        <thead class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
            <tr>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                      {{ 'ID' | translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{ 'Name' | translate }}
                </th>
                <!-- <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    {{ 'Mobile' | translate }}
                </th> -->
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    {{ 'Nationality' | translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    {{ 'Gender' | translate }}
                </th>
            </tr>
        </thead>
        <tbody>
            <tr class="border-t border-gray-300 text-xs md:text-sm bg-white">
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ SelectedStudent.id }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ SelectedStudent.en_name }}
                </td>
                <!-- <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ SelectedStudent.mobile }}
                </td> -->
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ this.DataToPrint?.student?.nationalityEnName || '-' }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ SelectedStudent.genderName }}
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Kindergarten Certificate Template (Hidden until PDF/Print) -->
<div *ngIf="showPDF" #kindergartenContainer 
     style="padding: 40px; font-family: Arial, sans-serif; background: white; max-width: 210mm; margin: 0 auto; position: absolute; top: -9999px; left: -9999px;">
  
  <!-- Header with logos -->
  <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px;">
    <div style="width: 30%; text-align: left;">
      <div style="font-size: 11px; line-height: 1.6;">
        <strong>{{ getSchoolNameEn() }}</strong><br>
        <!-- {{ getCurriculumEn() }}<br>
        License No. {{ getLicenseNumber() }}<br> -->
        Ministry of Education<br>
        Directorate General of Education in Riyadh<br>
        Private Education Office in Riyadh Region
      </div>
    </div>
    
    <div style="width: 30%; text-align: center; display: flex; justify-content: center; gap: 20px; align-items: center;">
      <img *ngIf="school?.reportImage" [src]="school.reportImage" style="height: 80px; width: auto; object-fit: contain;">
    </div>
    
    <div style="width: 30%; text-align: right; direction: rtl; font-size: 11px; line-height: 1.6;">
      <strong>{{ getSchoolNameAr() }}</strong><br>
      <!-- {{ getCurriculumAr() }}<br>
      ترخيص رقم: {{ getLicenseNumber() }}<br> -->
      وزارة التعليم<br>
      الإدارة العامة للتعليم بالرياض<br>
      مكتب التعليم الأهلي بمنطقة الرياض
    </div>
  </div>

  <!-- Title Section -->
  <div style="text-align: center; margin: 10px 0 10px 0;">
    <h1 style="font-size: 32px; font-weight: bold; margin: 0 0 5px 0;">Report Of Success</h1>
    <div style="direction: rtl; font-size: 24px; font-weight: bold;">بيان نجاح</div>
    <!-- <div style="font-size: 12px; margin-top: 5px;">
      <div>العام الدراسى</div>
      <div>2020_2021 G</div>
      <div>1441-1442 H</div>
    </div> -->
  </div>
  
  <!-- Two Column Layout for Student Info -->
  <div style="display: flex; gap: 30px; margin: 40px auto; max-width: 80%; justify-content: center;">
    
    <!-- Left Box - English Info -->
    <div style="flex: 0 1 300px; border: 3px solid #333; border-radius: 20px; padding: 15px; min-height: 200px;">
      <div style="font-size: 11px; line-height: 2;">
        <strong>Student's Name:</strong> {{ DataToPrint?.student?.en_name || '-' }}<br>
        <strong>Nationality:</strong> {{ DataToPrint?.student?.nationalityEnName || '-' }}<br>
        <strong>Place and date of birth:</strong> {{ DataToPrint?.student?.dateOfBirth || '-' }}<br>
        <strong>Passport NO:</strong> {{ DataToPrint?.student?.passportNo || '-' }}<br>
        <strong>ID NO:</strong> {{ DataToPrint?.student?.nationalIDExpiredDate || '-' }}<br>
        <strong>Admission Date:</strong> {{ DataToPrint?.student?.admissionDate || '-' }}<br>
        <strong>Previous School:</strong> {{ DataToPrint?.student?.previousSchool || '-' }}
      </div>
    </div>

    <!-- Right Box - Arabic Info -->
    <div style="flex: 0 1 300px; border: 3px solid #333; border-radius: 20px; padding: 15px; min-height: 200px; direction: rtl; text-align: right;">
      <div style="font-size: 11px; line-height: 2;">
        <strong>اسم الطالب:</strong> {{ DataToPrint?.student?.ar_name || '-' }}<br>
        <strong>الجنسية:</strong> {{ DataToPrint?.student?.nationalityArName || '-' }}<br>
        <strong>مكان وتاريخ الميلاد:</strong> {{ DataToPrint?.student?.dateOfBirth || '-' }}<br>
        <strong>رقم جواز السفر:</strong> {{ DataToPrint?.student?.passportNo || '-' }}<br>
        <strong>السجل المدنى:</strong> {{ DataToPrint?.student?.nationalIDExpiredDate || '-' }}<br>
        <strong>تاريخ الإلتحاق بالمدرسة:</strong> {{ DataToPrint?.student?.admissionDate || '-' }}<br>
        <strong>اسم المدرسة السابقة:</strong> {{ DataToPrint?.student?.previousSchool || '-' }}
      </div>
    </div>
  </div>

  <!-- License Info -->
  <!-- <div style="text-align: center; margin: 30px 0 20px 0; font-size: 13px;">
    Under the supervision of the Ministry of Education License ({{ getLicenseNumber() }})
  </div> -->

  <!-- Kindergarten Section Title -->
  <div style="text-align: center; margin: 25px 0;">
    <h2 style="font-size: 36px; font-weight: bold; margin: 0; letter-spacing: 1px;">Kindergarten Section</h2>
  </div>

  <!-- Certification Text -->
  <div style="text-align: center; font-size: 13px; line-height: 1.8; margin: 25px 0;">
    <p style="margin: 5px 0;">This is to certify that learner,</p>
    <p style="font-size: 16px; font-weight: bold; margin: 10px 0; text-transform: uppercase;">
      {{ DataToPrint?.student?.en_name || 'STUDENT NAME' }}
    </p>
    <p style="margin: 5px 0;">Is registered in the school academic year <strong>{{ DataToPrint?.student?.currentAcademicYear || '-' }}</strong></p>
    <p style="margin: 5px 0;">And promoted to <strong>{{ getPromotedToGrade() }}</strong> in the school academic year <strong>{{ getNextAcademicYear() }}</strong></p>
  </div>

  <!-- Footer with Signature -->
  <div style="display: flex; justify-content: space-between; margin-top: 60px; padding-top: 20px;">
    <div style="width: 45%; text-align: left; font-size: 12px;">
      <p style="margin: 5px 0;"><strong>Best Regards,</strong></p>
      <p style="margin: 5px 0;">KG Section Principal</p>
      <p style="margin: 30px 0 5px 0;">Name: ......................................</p>
      <p style="margin: 5px 0;">Signature: ......................................</p>
      <p style="margin: 5px 0;">Date: {{ CurrentDate }}</p>
    </div>
    
    <div style="width: 45%; text-align: right; direction: rtl; font-size: 12px;">
      <p style="margin: 5px 0;"><strong>قائدة رياض الأطفال</strong></p>
      <p style="margin: 30px 0 5px 0;">الاسم: ......................................</p>
      <p style="margin: 5px 0;">التوقيع: ......................................</p>
      <p style="margin: 5px 0;">التاريخ: {{ ArabicCurrentDate }}</p>
    </div>
  </div>
</div>