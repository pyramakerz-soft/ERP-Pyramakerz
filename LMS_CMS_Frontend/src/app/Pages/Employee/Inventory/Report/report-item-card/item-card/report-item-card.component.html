<div class="flex justify-between">
    <h1 class="primaryTxt font-bold text-2xl leading-9">
          {{'Item'| translate }} {{'Card'| translate }} {{ showAverageColumn ? ' With Average Information' : '' }}
    </h1>
</div>

<div class="my-5 flex flex-wrap justify-between items-center">
    <!-- Store Selector -->
    <div class="flex flex-col w-[24%] mb-4">
        <label class="mb-2 font-medium" for="store">{{'Store'| translate }}</label>
        <select class="rounded-lg border border-solid border-gray-300 px-4 py-3" id="store"
            [(ngModel)]="selectedStoreId" (ngModelChange)="onFilterChange()" required>
            <option [ngValue]="null" disabled selected hidden> {{'Choose'| translate }} {{'Store'| translate }}</option>
            <option *ngFor="let store of stores" [ngValue]="store.id">{{ store.name }}</option>
        </select>
    </div>

    <!-- Item Selector -->
    <div class="flex flex-col w-[24%] mb-4">
        <label class="mb-2 font-medium" for="item"> {{'Item'| translate }}</label>
        <select class="rounded-lg border border-solid border-gray-300 px-4 py-3" id="item" [(ngModel)]="selectedItemId"
            (ngModelChange)="onFilterChange()" required>
            <option [ngValue]="null" disabled selected hidden>{{'Choose'| translate }} {{'Item'| translate }}</option>
            <option *ngFor="let item of items" [ngValue]="item.id">{{ item.enName }}</option>
        </select>
    </div>

    <div class="flex flex-col w-[24%] mb-4">
        <label class="mb-2 font-medium" for="dateFrom">{{'Date From'| translate }}</label>
        <input type="date" class="rounded-lg border border-solid border-gray-300 px-4 py-3" id="dateFrom"
            [(ngModel)]="dateFrom" (ngModelChange)="onFilterChange()" required>
    </div>

    <div class="flex flex-col w-[24%] mb-4">
        <label class="mb-2 font-medium" for="dateTo">{{'Date To'| translate }}</label>
        <input type="date" class="rounded-lg border border-solid border-gray-300 px-4 py-3" id="dateTo"
            [(ngModel)]="dateTo" (ngModelChange)="onFilterChange()" required>
    </div>

    <div class="w-[99%] flex justify-end">
        <button class="p-4 font-medium text-xl rounded-lg" (click)="viewReport()"
            [disabled]="!dateFrom || !dateTo || !selectedStoreId || !selectedItemId" [ngClass]="{ 
            'bg-gray-100 text-gray-300': !dateFrom || !dateTo || !selectedStoreId || !selectedItemId, 
            'secondaryBg text-white': dateFrom && dateTo && selectedStoreId && selectedItemId
        }">
            {{'View Report'| translate }}
        </button>
    </div>
</div>

<div *ngIf="showTable" class="mb-5 flex justify-end space-x-4">
    <img class="w-5 cursor-pointer" src="Icons/Excel.png" (click)="exportExcel()" title="Export to Excel">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()" title="Export to PDF">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()" title="Print Report">
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <!-- Change this line in the PDF print component -->
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'Item Card Report'" [infoRows]="getInfoRows()"
            [tableHeaders]="getPdfTableHeaders()" [tableData]="transactionsForExport" #pdfPrintComponent>
        </app-pdf-print>
    </div>
</div>
<div *ngIf="showTable" class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD]">
    <table class="w-full tabe inset-0 bg-[#EBEBEB] text-left text-[#6F6F6F]">
        <thead class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
            <tr>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Date'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                  {{'Transaction Type'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Invoice Numberv'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Authority'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Income'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Outcome'| translate }}
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Balance'| translate }}
                </th>
                <!-- <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Cost Balance
                </th> -->
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                     {{'Price'| translate }}
                </th>
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                      {{'Total'| translate }} {{'Price'| translate }}
                </th>
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                      {{'Average'| translate }} {{'Cost'| translate }}
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="combinedData.length === 0">
                <td [attr.colspan]="showAverageColumn ? 11 : 7"
                    class="bg-white px-4 py-2 h-[72px] text-center border-t border-gray-300 text-xs md:text-sm">
                     {{'No Data Found'| translate }}
                </td>
            </tr>

            <tr *ngFor="let row of combinedData; let i = index" [ngClass]="{ 
                    'bg-[#F7F7F7]': i % 2 === 1, 
                    'bg-white': i % 2 !== 1,
                    'font-bold': row.isSummary
                }" class="border-t border-gray-300 text-xs md:text-sm">
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.date ? (row.date | date:'MMMM d, yyyy') : '-' }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.transactionType }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.invoiceNumber }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.authority }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.income }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.outcome }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.balance }}
                </td>
                <!-- <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.isSummary ? (row.costBalance !== '-' ? (row.costBalance | number:'1.2-2') : '-') : '-' }}  
                </td> -->
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.price }}
                </td>
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.totalPrice }}
                </td>
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.averageCost }}
                </td>
            </tr>
        </tbody>
    </table>
</div>