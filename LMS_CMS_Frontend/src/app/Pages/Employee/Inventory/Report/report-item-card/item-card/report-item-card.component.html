<div class="flex justify-between">
    <h1 class="primaryTxt font-bold text-2xl leading-9">
        Item Card{{ showAverageColumn ? ' With Average Information' : '' }}
    </h1>
</div>

<div class="my-5 flex flex-wrap md:flex-nowrap items-end space-x-0 md:space-x-6 space-y-4 md:space-y-0 mb-6">
    <!-- Store Selector -->
    <div class="w-full md:w-1/4">
        <label class="block mb-2 text-sm font-medium text-gray-900" for="store">Store</label>
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full" id="store"
            [(ngModel)]="selectedStoreId" (ngModelChange)="onFilterChange()" required>
            <option [ngValue]="null" disabled selected hidden>Choose Store</option>
            <option *ngFor="let store of stores" [ngValue]="store.id">{{ store.name }}</option>
        </select>
    </div>

    <!-- Item Selector -->
    <div class="w-full md:w-1/4">
        <label class="block mb-2 text-sm font-medium text-gray-900" for="item">Item</label>
        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full" id="item"
            [(ngModel)]="selectedItemId" (ngModelChange)="onFilterChange()" required>
            <option [ngValue]="null" disabled selected hidden>Choose Item</option>
            <option *ngFor="let item of items" [ngValue]="item.id">{{ item.enName }}</option>
        </select>
    </div>

    <!-- Date From -->
    <div class="w-full md:w-1/4">
        <label class="block mb-2 text-sm font-medium text-gray-900" for="dateFrom">Date From</label>
        <input type="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            id="dateFrom" [(ngModel)]="dateFrom" (ngModelChange)="onFilterChange()" required>
    </div>

    <!-- Date To -->
    <div class="w-full md:w-1/4">
        <label class="block mb-2 text-sm font-medium text-gray-900" for="dateTo">Date To</label>
        <input type="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            id="dateTo" [(ngModel)]="dateTo" (ngModelChange)="onFilterChange()" required>
    </div>

    <div class="w-full md:w-1/6 flex justify-end mt-4 md:mt-0">
        <button class="p-3 font-medium text-xl rounded-lg" (click)="viewReport()"
            [disabled]="!dateFrom || !dateTo || !selectedStoreId || !selectedItemId" [ngClass]="{
                'bg-gray-100 text-gray-300': !dateFrom || !dateTo || !selectedStoreId || !selectedItemId,
                'secondaryBg text-white': dateFrom && dateTo && selectedStoreId && selectedItemId
            }">
            View Report
        </button>
    </div>
</div>

<div *ngIf="showTable" class="mb-5 flex justify-end space-x-4">
    <img class="w-5 cursor-pointer" src="Icons/Excel.png" title="Export to Excel">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()" title="Export to PDF">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()" title="Print Report">
</div>


<div *ngIf="showTable" class="mt-5 overflow-x-auto rounded-2xl border border-[#BDBDBD]">
    <table class="w-full tabe inset-0 bg-[#EBEBEB] text-left text-[#6F6F6F]">
        <thead class="bg-[#EBEBEB] text-sm md:text-base border border-[#BDBDBD] border-t-0 border-l-0">
            <tr>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Date
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Transaction Type
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Invoice Number
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Authority
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Income
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Outcome
                </th>
                <th class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Balance
                </th>
                <!-- <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Cost Balance
                </th> -->
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Price
                </th>
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Total Price
                </th>
                <th *ngIf="showAverageColumn"
                    class="py-3 px-4 min-w-[120px] whitespace-nowrap border border-[#EAECF0] border-t-0 border-l-0">
                    Average Cost
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="combinedData.length === 0">
                <td [attr.colspan]="showAverageColumn ? 11 : 7"
                    class="bg-white px-4 py-2 h-[72px] text-center border-t border-gray-300 text-xs md:text-sm">
                    No Data Found
                </td>
            </tr>

            <tr *ngFor="let row of combinedData; let i = index" [ngClass]="{ 
                    'bg-[#F7F7F7]': i % 2 === 1, 
                    'bg-white': i % 2 !== 1,
                    'font-bold': row.isSummary
                }" class="border-t border-gray-300 text-xs md:text-sm">
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.date ? (row.date | date:'yyyy-MM-dd') : '-' }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.transactionType }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.invoiceNumber }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.authority }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.income }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.outcome }}
                </td>
                <td class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.balance }}
                </td>
                <!-- <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.isSummary ? (row.costBalance !== '-' ? (row.costBalance | number:'1.2-2') : '-') : '-' }}  
                </td> -->
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.price }}
                </td>
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.totalPrice }}
                </td>
                <td *ngIf="showAverageColumn" class="py-5 px-4 border border-[#EAECF0] border-t-0 border-l-0">
                    {{ row.averageCost }}
                </td>
            </tr>
        </tbody>
    </table>
</div>


<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'Item Card Report'" 
            [tableHeaders]="getPdfTableHeaders()"
            [infoRows]="[
                { keyEn: 'From Date: ' + dateFrom },
                { keyEn: 'To Date: ' + dateTo },
                { keyEn: 'Store: ' + getStoreName() },
                { keyEn: 'Item: ' + getItemName() },
            ]"
            [tableData]="transactionsForExport" #pdfPrintComponent>
        </app-pdf-print>
    </div>
</div>

<!-- <div class="absolute  -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [school]="school" [fileName]="'Inventory Transactions Report'"
        [infoRows]="[
      { keyEn: 'From Date: ' + this.dateFrom },
      { keyEn: 'To Date: ' + this.dateTo },
      { keyEn: 'Store: ' + this.getStoreName() },
            ]"
        [tableHeaders]="['Invoice #', 'Date', 'Store', 'Total Amount', 'Transaction Type']"
        [tableData]="transactionsForExport" #pdfComponentRef>
    </app-pdf-print>
</div>
</div> -->