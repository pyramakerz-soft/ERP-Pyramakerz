<div class="p-6">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-2xl font-semibold text-gray-800">{{ 'Offers' | translate }}</h1>
    <div class="flex items-center gap-4">
      <app-search [keysArray]="keysArray"></app-search>
      <button (click)="Create()"
        class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition">
        <span>+</span> {{ 'Create Offer' | translate }}
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto rounded-2xl border border-gray-300 shadow-sm">
    <table class="w-full text-left">
      <thead class="bg-gray-100 text-sm font-medium text-gray-700">
        <tr>
          <th class="px-6 py-4">Department</th>
          <th class="px-6 py-4">Title</th>
          <th class="px-6 py-4">Time logged</th>
          <th class="px-6 py-4">Uploaded Files</th>
          <th class="px-6 py-4">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <tr *ngIf="TableData.length === 0">
          <td colspan="5" class="text-center py-12 text-gray-500">{{ 'No Data Found' | translate }}</td>
        </tr>
        <tr *ngFor="let offer of TableData; let i = index" class="hover:bg-gray-50">
          <td class="px-6 py-4">
            <span [class]="getDepartmentColor(offer.departmentName)" class="px-4 py-1 rounded-full text-sm font-medium">
              {{ offer.departmentName }}
            </span>
          </td>
          <td class="px-6 py-4 text-gray-800">{{ offer.titleName }}</td>
          <td class="px-6 py-4 text-gray-600">{{ offer.timeLogged | date:'dd MMM yyyy' }}</td>
          <td class="px-6 py-4">
            <div class="flex flex-col gap-2">
              <div class="flex items-center gap-3">
                <i class="far fa-file-pdf text-xl text-red-600"></i>
                <span class="text-sm text-gray-700 truncate max-w-[200px]">{{ offer.fileName }}</span>
              </div>
              <p class="text-orange-600 text-sm cursor-pointer hover:underline font-medium"
                (click)="openFile(offer.uploadedFilePath)">
                {{ 'Click to' | translate }} {{ 'View' | translate }}
              </p>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex items-center gap-4">
              <button *ngIf="AllowDelete && IsAllowDelete(offer.insertedByUserId)"
                      (click)="Delete(offer.id)" class="text-red-600 hover:text-red-800">
                <i class="far fa-trash-can"></i>
              </button>
              <button *ngIf="AllowEdit && IsAllowEdit(offer.insertedByUserId)"
                      (click)="Edit(offer)" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-pencil"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div *ngIf="isModalVisible" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 relative mx-4">
    <button (click)="isModalVisible = false" class="absolute top-6 right-6 text-gray-400 hover:text-gray-700">
      <i class="fas fa-xmark text-2xl"></i>
    </button>

    <h2 class="text-2xl font-semibold mb-8">{{ mode === 'Create' ? 'Create Offer' : 'Edit Offer' | translate }}</h2>
    
    <div class="space-y-6 mb-8">
      <!-- Department -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          {{ 'Department' | translate }}
        </label>
        <select [(ngModel)]="currentOffer.departmentID"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition">
          <option value="0" disabled selected>{{ 'Choose department' | translate }}</option>
          <option *ngFor="let dept of departments" [value]="dept.id">
            {{ dept.name }}
          </option>
        </select>
      </div>

      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          {{ 'Title' | translate }}
        </label>
        <select [(ngModel)]="currentOffer.titleID"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition">
          <option value="0" disabled selected>{{ 'Choose title' | translate }}</option>
          <option *ngFor="let title of titles" [value]="title.id">
            {{ title.name }}
          </option>
        </select>
      </div>
    </div>

    <!-- File Upload -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-3">Upload File</label>
      <div (drop)="onFileDrop($event)" (dragover)="$event.preventDefault()" (dragenter)="$event.preventDefault()"
        class="border-2 border-dashed border-gray-300 rounded-2xl p-10 text-center cursor-pointer hover:border-orange-500 transition bg-gray-50"
        [class.border-orange-500]="selectedFileName" (click)="fileInput.click()">

        <input #fileInput type="file" (change)="onFileSelect($event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
          class="hidden" />

        <div *ngIf="!selectedFileName" class="space-y-4">
          <div class="mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center">
            <i class="fas fa-cloud-upload-alt text-3xl text-orange-500"></i>
          </div>
          <p class="text-gray-700 font-medium">Click to upload or drag and drop</p>
          <p class="text-sm text-gray-500">
            Supported formats: PDF, Word, JPG, PNG
          </p>
        </div>
        <!-- File selected -->
        <div *ngIf="selectedFileName" class="space-y-3">
          <i class="far fa-file-pdf text-5xl text-red-600"></i>
          <p class="text-gray-800 font-medium truncate max-w-md">{{ selectedFileName }}</p>
          <button (click)="removeFile(); $event.stopPropagation()" class="text-red-600 hover:text-red-800 text-sm">
            Remove file
          </button>
        </div>
      </div>
    </div>

    <!-- Errors -->
    <div *ngIf="validationErrors.length" class="mb-4">
      <p *ngFor="let err of validationErrors" class="text-red-600 text-sm">{{ err }}</p>
    </div>

    <!-- Submit -->
    <div class="flex justify-end">
      <button (click)="CreateOrEdit()" [disabled]="isLoading"
        class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg flex items-center gap-2">
        <span *ngIf="!isLoading">{{ mode === 'Create' ? 'Create' : 'Save' | translate }}</span>
        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
      </button>
    </div>
  </div>
</div>