<div class="flex justify-between items-center">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
            <i class="fa-solid fa-chevron-left cursor-pointer" 
            [class.rotate-180]="isRtl"(click)="moveToAssignment()"></i>
        <h1 class="primaryTxt font-semibold text-2xl leading-9">{{assignment.englishName}}</h1>
    </div>
    <button [disabled]="isLoading"
        class="rounded-lg secondaryBorder secondaryTxt px-4 py-3 flex items-center justify-center gap-2"
        (click)="Submit()">
        <span *ngIf="!isLoading"> {{ 'Submit' | translate }}</span>
        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
    </button>
</div>

<div *ngIf="assignment.assignmentTypeID==1">
    <div *ngIf="assignment.linkFile" class="bg-white p-4 rounded-lg">
        <div class="flex flex-wrap gap-4">
            <div class="flex flex-col w-[34%]">
                <h1 class="text-sm font-semibold mb-2">{{ 'Name' | translate }}</h1>
                <p class="text-sm font-medium text-gray-700 mb-4">{{ assignment.linkFile.split('/').pop() }}</p>
                <div class="border border-cacaca rounded-lg p-6">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-2 rtl:space-x-reverse">
                            <i class="fa-solid fa-file"></i>
                            <p class="text-sm font-medium text-gray-700 truncate max-w-[150px]">{{
                                assignment.linkFile.split('/').pop() }}</p>
                        </div>
                    </div>
                    <a [href]="assignment.linkFile" target="_blank" rel="noopener"
                        class="secondaryTxt cursor-pointer hover:underline mt-2">
                        {{ 'Click to' | translate }} {{ 'View' | translate }}
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="w-[34%] mb-4">
        <div class="bg-[#F6F6F6] flex items-center space-x-4 rtl:space-x-reverse w-full rounded-md border-dashed border-2">
            <div class="flex justify-center w-full">
                <label for="file" class="cursor-pointer flex flex-col items-center rounded-xl px-6 py-3 lg:py-5">
                    <img *ngIf="!assignmentStudent.linkFile && !assignmentStudent.file" src="https://d393tpgdl2mqkp.cloudfront.net/public/Images/Icon frame.png"
                        class="w-1/4">
                    <img *ngIf="!assignmentStudent.linkFile && assignmentStudent.file" src="https://d393tpgdl2mqkp.cloudfront.net/public/Images/FileAttached.png"
                        class="w-1/4">
                    <img *ngIf="assignmentStudent.linkFile" [src]="assignmentStudent.linkFile"
                        class="w-1/3 object-cover">
                    <p class="font-normal text-xs md:text-sm text-[#8E8E93] mt-3"><span class="secondaryTxt">
                         {{ 'Click to' | translate }} {{ 'Upload' | translate }} {{ 'Answer' | translate }}
                        </span></p>
                    <p class="font-normal text-xs md:text-sm text-[#8E8E93]"> {{ '(Max. File size: 25 MB)' | translate }}</p>
                </label>
                <input id="file" type="file" class="hidden" (change)="onImageFileSelected($event)"
                    accept=".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf" />
            </div>
        </div>
        <span *ngIf="validationErrors['file']" class="text-red-500  font-normal text-xs md:text-sm">{{
            validationErrors['file'] }}</span>
    </div>
</div>

<div *ngIf="assignment.assignmentTypeID == 2 || assignment.assignmentTypeID == 3">
    <div *ngFor="let row of assignmentStudent.assignmentStudentQuestions; let i = index"
        class="mt-5 border rounded-lg p-4 bg-gray-50 shadow-sm">

        <!-- Question & Index -->
        <div class="flex justify-between items-start mb-3">
            <div class="font-bold text-lg flex gap-2">
                <span>{{ i + 1 }}-</span>
                <span [innerHTML]="row.questionDesc"></span>
            </div>
        </div>

        <!-- Optional image -->
        <div *ngIf="row.questionImage" class="mb-3">
            <img [src]="row.questionImage" alt="Question Image"
                class="max-w-full max-h-64 rounded border border-gray-300" />
        </div>

        <!-- True/False -->
        <div *ngIf="row.questionTypeID === 1" class="mt-3 space-y-1">
            <label class="flex items-center gap-2">
                <input type="radio" name="trueFalse_{{ i }}" [(ngModel)]="row.answer" value="True" /> {{ 'True' | translate }}
            </label>
            <label class="flex items-center gap-2">
                <input type="radio" name="trueFalse_{{ i }}" [(ngModel)]="row.answer" value="False" /> {{ 'False' | translate }}
            </label>
        </div>

        <!-- MCQ -->
        <div *ngIf="row.questionTypeID === 2" class="mt-3 space-y-2">
            <label *ngFor="let opt of row.questionBankOptions" class="flex items-center gap-2">
                <input type="radio" name="mcq_{{ i }}" [(ngModel)]="row.answerOptionID" [value]="opt.id" />
                {{ opt.option }}
            </label>
        </div>

        <!-- Fill in the Blank -->
        <div *ngIf="row.questionTypeID === 3" class="mt-4 space-y-2">
            <input *ngFor="let answer of row.assignmentStudentQuestionAnswerOption" [(ngModel)]="answer.answer"
                class="border border-gray-300 rounded px-3 py-2 w-full" type="text" placeholder="Answer...{{ 'Answer...' | translate }}" />
        </div>

        <!-- Drag & Drop -->
        <div *ngIf="row.questionTypeID === 4" class="mt-6">
            <!-- Answer Pool (Source) -->
            <div cdkDropList [cdkDropListData]="row.answerPool" [cdkDropListConnectedTo]="subDropIds"
                class="flex flex-wrap justify-center gap-4 font-semibold mb-6 text-gray-700 min-h-[60px]">
                <div *ngFor="let option of row.answerPool" cdkDrag [cdkDragData]="option"
                    class="bg-white shadow px-4 py-2 border rounded cursor-move min-w-[80px] text-center">
                    {{ option|translate }}
                </div>
            </div>
            <!-- Sub-Questions with Drop Targets -->
            <div *ngFor="let sub of row.subBankQuestion; let i = index">
                <div class="flex justify-between items-center border-b border-gray-300 py-3 gap-4">
                    <div class="w-2/3 text-gray-800 font-medium flex items-center">
                        <span class="text-gray-500 mr-1">{{ i + 1 }}.</span>
                        {{ sub.description|translate}}
                    </div>
                    <div class="w-1/3">
                        <div [id]="'subDrop_' + i" cdkDropList [cdkDropListData]="emptyStringList"
                            [cdkDropListConnectedTo]="['answerPool']"
                            (cdkDropListDropped)="onDropMatch(row, sub, $event)"
                            class="min-h-[42px] bg-gray-100 border border-dashed border-gray-400 rounded-md px-3 py-2 flex items-center justify-between">
                            <span *ngIf="sub.answer" class="font-semibold">{{ sub.answer }}</span>
                            <span *ngIf="!sub.answer" class="text-gray-400 italic">{{ 'Drop here...' | translate }}</span>
                            <button *ngIf="sub.answer" (click)="removeAnswer(row, sub)"
                                class="ml-2 text-red-500 text-sm">✕</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order -->
        <div *ngIf="row.questionTypeID === 5" class="mt-4">
            <div cdkDropList [cdkDropListData]="row.assignmentStudentQuestionAnswerOption"
                (cdkDropListDropped)="onDrop(row.assignmentStudentQuestionAnswerOption, $event)" class="space-y-2">
                <div *ngFor="let answer of row.assignmentStudentQuestionAnswerOption" cdkDrag
                    class="bg-gray-100 border border-gray-400 rounded-md px-4 py-2 flex items-center justify-between cursor-move">
                    <span class="text-gray-700">{{ answer.answer }}</span>
                    <span class="text-gray-500 text-xl">≡</span>
                </div>
            </div>
        </div>

        <!-- Essay -->
        <div *ngIf="row.questionTypeID === 6" class="mt-3">
            <textarea [(ngModel)]="row.answer" rows="4" class="border border-gray-300 rounded px-3 py-2 w-full"
                placeholder="{{ 'Your answer...' | translate }}"></textarea>
        </div>

        <div *ngIf="questionValidationErrors[i]" class="text-red-500 text-sm mt-2">
            {{ questionValidationErrors[i] }}
        </div>
    </div>
</div>