<div class="flex justify-between items-center mb-5">
    <div class="flex justify-between items-center space-x-5 rtl:space-x-reverse">
        <h1 class="font-semibold text-2xl leading-9">
            TimeTable
        </h1>
    </div>
</div>

<div class="flex justify-start items-center space-x-4 rtl:space-x-reverse mb-4">
    <div class="w-[48%]">
        <label for="day" class="block mb-2 text-sm font-medium text-gray-900"> {{ 'Days' | translate }}</label>
        <select id="day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5 w-full"
            [(ngModel)]="SelectedDay" (change)="FilterTimeTable();">
            <option value=0 disabled selected hidden> {{ 'Select' | translate }} {{ 'Day' | translate }}</option>
            <option *ngFor="let day of days" [value]="day.id">
                {{ day.name }}
            </option>
            <option *ngIf="days.length === 0" disabled selected> {{ 'No Data Found' | translate }}</option>
        </select>
    </div>
    <div *ngIf="SelectedDay!=0 || SelectedGrade!=0" class="rounded-full p-2 border-4" (click)="GetTimeTable()">
        <i
            class="fa-solid fa-rotate-left secondaryTxt text-2xl w-8 h-8 text-center hover:cursor-pointer rounded-full"></i>
    </div>
</div>

<div class=" my-5 flex justify-end space-x-4 rtl:space-x-reverse">
    <img class="w-5 cursor-pointer" src="Icons/Excel.png" (click)="DownloadAsExcel()">
    <img class="w-5 cursor-pointer" src="Icons/PDF.png" (click)="DownloadAsPDF()">
    <img class="w-5 cursor-pointer" src="Icons/Print.png" (click)="Print()">
</div>

<div class="w-full overflow-x-auto">

    <!-- inner scroll container (vertical) -->
    <div class="min-w-max overflow-y-auto max-h-[80vh]">

        <div class="bg-gray-300 text-center text-xl font-bold py-4 mb-4 min-w-max sticky top-0 z-10">
            {{ 'Time Table' | translate }}
        </div>

        <table class="table-auto w-full min-w-max text-sm text-left border-collapse border border-gray-300">
            <thead class="bg-gray-100">
                <tr>
                    <th class="border p-2 whitespace-nowrap">{{ 'Day' | translate }}</th>
                    <th class="border p-2 whitespace-nowrap"
                        *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                        {{ 'Session' | translate }} {{ period + 1 }}
                    </th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let day of TimeTable">
                    <td class="border p-2 font-medium whitespace-nowrap">{{ day.dayName }}</td>

                    <td class="border p-2 whitespace-nowrap"
                        *ngFor="let i of [].constructor(MaxPeriods); let period = index">

                        <ng-container *ngFor="let grade of day.grades">
                            <ng-container *ngFor="let classroom of grade.classrooms">

                                <ng-container *ngIf="classroom.sessions[period] as session">

                                    <div *ngFor="let subject of session.subjects"
                                        class="rounded-lg border-l-8 border-blue-500 bg-blue-50 px-2 py-1 mb-1 text-gray-800 shadow whitespace-nowrap">
                                        <div class="text-xs">{{ subject.subjectName }}</div>
                                        <div class="text-xs">{{ subject.teacherName }}</div>
                                    </div>

                                    <div *ngIf="session.dutyTeacherName"
                                        class="rounded-lg border-l-8 border-red-500 bg-red-100 px-2 py-1 text-gray-800 shadow whitespace-nowrap">
                                        <div class="text-xs">{{ 'Duty' | translate }}</div>
                                        <div class="text-xs">{{ session.dutyTeacherName }}</div>
                                    </div>

                                    <div *ngIf="session.subjects.length === 0 && !session.dutyTeacherName"
                                        class="text-gray-400 whitespace-nowrap">
                                        --
                                    </div>

                                </ng-container>

                                <div *ngIf="!classroom.sessions[period]" class="text-gray-400 whitespace-nowrap">--
                                </div>

                            </ng-container>
                        </ng-container>

                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <div class="overflow-x-auto">
            <div class="bg-gray-300 text-center text-xl font-bold py-4 mb-4 print:mb-8 print:pb-4">
                {{ ClassName }}
            </div>

            <table class="table-auto w-full min-w-max text-sm text-left border-collapse border border-gray-300">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border p-2 whitespace-nowrap">{{ 'Day' | translate }}</th>
                        <th class="border p-2 whitespace-nowrap"
                            *ngFor="let i of [].constructor(MaxPeriods); let period = index">
                            {{ 'Session' | translate }} {{ period + 1 }}
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let day of TimeTable">
                        <td class="border p-2 font-medium whitespace-nowrap">{{ day.dayName }}</td>

                        <td class="border p-2 whitespace-nowrap"
                            *ngFor="let i of [].constructor(MaxPeriods); let period = index">

                            <ng-container *ngFor="let grade of day.grades">
                                <ng-container *ngFor="let classroom of grade.classrooms">

                                    <ng-container *ngIf="classroom.sessions[period] as session">

                                        <div *ngFor="let subject of session.subjects"
                                            class="rounded-lg border-l-8 border-blue-500 bg-blue-50 px-2 py-1 mb-1 text-gray-800 shadow whitespace-nowrap">
                                            <div class="text-xs">{{ subject.subjectName }}</div>
                                            <div class="text-xs">{{ subject.teacherName }}</div>
                                        </div>

                                        <div *ngIf="session.dutyTeacherName"
                                            class="rounded-lg border-l-8 border-red-500 bg-red-100 px-2 py-1 text-gray-800 shadow whitespace-nowrap">
                                            <div class="text-xs">{{ 'Duty' | translate }}</div>
                                            <div class="text-xs">{{ session.dutyTeacherName }}</div>
                                        </div>

                                        <div *ngIf="session.subjects.length === 0 && !session.dutyTeacherName"
                                            class="text-gray-400 whitespace-nowrap">
                                            --
                                        </div>

                                    </ng-container>

                                    <div *ngIf="!classroom.sessions[period]" class="text-gray-400 whitespace-nowrap">--
                                    </div>

                                </ng-container>
                            </ng-container>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="absolute -top-[9999px] -left-[9999px]">
    <div id="Data" class="hidden">
        <app-pdf-print *ngIf="showPDF" [fileName]="'TimeTable'" [infoRows]="[
                { keyEn: 'Name: ' + TimeTableName },
            ]" [tableDataWithHeaderArray]="DataToPrint" #pdfComponentRef>
        </app-pdf-print>
    </div>
</div>