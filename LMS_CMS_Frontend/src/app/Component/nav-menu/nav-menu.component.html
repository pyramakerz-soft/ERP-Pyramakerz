<div class="rounded-lg py-2 lg:py-3 px-3 lg:px-6 primaryBg">
    <div class="flex items-center justify-between">
        <div>
            <img src="Images/OctaWhiteLogo3.png">
        </div>
        <div>
            <input type="text"
                class="lg:w-[543px] lg:h-[53px] rounded-[8px] border border-gray-300 px-3 lg:px-4 py-2 lg:py-3"
                placeholder="{{ 'Enter Key Word' | translate }}" />
        </div> 
        <div class="flex space-x-4 rtl:space-x-reverse items-center"> 
            <div class="relative dropdown-container"> 
                <div class="relative cursor-pointer hover:opacity-80 hover:scale-110 transition-all" (click)="toggleNotificationPopup()" >
                    <i class="fi fi-rr-comment-alt-dots text-white text-3xl flex items-center"></i> 
                    <span *ngIf="notificationsUnSeenCount > 0"
                        class="primaryBg absolute -top-2 -right-2 border-2 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold" >
                        {{ notificationsUnSeenCount }}
                    </span>
                </div>
            </div>
            <div class="relative dropdown-container"> 
                <div class="relative cursor-pointer hover:opacity-80 hover:scale-110 transition-all" (click)="toggleRequestPopup()" > 
                    <i class="fi fi-rs-paper-plane text-white text-3xl flex items-center"></i> 
                    <span *ngIf="requestsUnSeenCount > 0"
                        class="primaryBg absolute -top-2 -right-2 border-2 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold" >
                        {{ requestsUnSeenCount }}
                    </span>
                </div>
                <div *ngIf="isRequuestPopupOpen" class="absolute ltr:right-0 rtl:left-0 mt-2 w-[440px] bg-white shadow-lg z-50">
                    <div class="flex justify-between space-x-3 rtl:space-x-reverse p-4">
                        <h3 class="primaryTxt font-semibold">Requests</h3>
                        <button (click)="viewAllRequests()" class="text-gray-500 text-sm hover:text-gray-700 transition">View All <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                    <ul>
                        <li *ngFor="let request of requests; let i = index" class="relative" (click)="viewRequest(request)">
                            <div *ngIf="request.transfereeID == User_Data_After_Login.id && User_Data_After_Login.type == 'employee'">
                                <div *ngIf="!request.seenOrNotByTransferee"
                                    class="absolute top-2 left-2 w-2.5 h-2.5 border border-[#4d8db4] bg-[#8ccff8b6] rounded-full z-10">
                                </div>
                                <div class="flex hover:bg-gray-100 p-3 items-start" [ngClass]="{'border-b': i != requests.length, 'bg-[#e3ebf0b6]': !request.seenOrNotByTransferee}">
                                    <div class="flex-shrink-0">
                                        <img src="Images/person-dummy.jpg" class="cursor-pointer rounded-full w-14" alt="Profile Photo">
                                    </div>
                                    <div class="ml-4 text-start w-full"> 
                                        <!-- <p class="primaryTxt text-sm"><span class="font-semibold">{{ notification.insertedByUserName }}</span> Notifed You</p> -->
                                        <div class="mt-4 flex flex-col space-y-3">
                                            <div *ngIf="request.message" class="w-[70%] border-l-4 border-gray-300 pl-4 primaryTxt text-base leading-relaxed truncate overflow-hidden whitespace-nowrap">
                                                {{request.message}}
                                            </div> 
                                            <div *ngIf="request.fileLink" class="flex space-x-2 items-center">
                                                <img src="Images/Icon frame.png" class="border p-[4px] w-10 rounded-md" alt="Photo">
                                                <span class="primaryTxt text-sm font-semibold">{{getFileName(request.fileLink)}}</span>
                                            </div> 
                                            <div *ngIf="request.link" class="secondaryTxt text-sm font-semibold">        
                                                <a [href]="request.link" class="border-b border-[#089B41] hover:text-[#089b408c]"
                                                    target="_blank" (click)="$event.stopPropagation();"
                                                    rel="noopener"> <!-- Prevents the new tab from having access to the original page via window.opener -->
                                                    View Link
                                                </a>                                    
                                            </div> 
                                        </div>
                                        <p class="text-[#BDBDBD] text-sm font-semibold mt-2">{{ formatInsertedAt(request.insertedAt) }}</p>
                                    </div>
                                </div>
                            </div> 
                            <div *ngIf="request.transfereeID != User_Data_After_Login.id">
                                <div *ngIf="!request.seenOrNot"
                                    class="absolute top-2 left-2 w-2.5 h-2.5 border border-[#4d8db4] bg-[#8ccff8b6] rounded-full z-10">
                                </div>
                                <div class="flex hover:bg-gray-100 p-3 items-start" [ngClass]="{'border-b': i != requests.length, 'bg-[#e3ebf0b6]': !request.seenOrNot}">
                                    <div class="flex-shrink-0">
                                        <img src="Images/person-dummy.jpg" class="cursor-pointer rounded-full w-14" alt="Profile Photo">
                                    </div>
                                    <div class="ml-4 text-start w-full"> 
                                        <!-- <p class="primaryTxt text-sm"><span class="font-semibold">{{ notification.insertedByUserName }}</span> Notifed You</p> -->
                                        <div class="mt-4 flex flex-col space-y-3">
                                            <div *ngIf="request.message" class="w-[70%] border-l-4 border-gray-300 pl-4 primaryTxt text-base leading-relaxed truncate overflow-hidden whitespace-nowrap">
                                                {{request.message}}
                                            </div> 
                                            <div *ngIf="request.fileLink" class="flex space-x-2 items-center">
                                                <img src="Images/Icon frame.png" class="border p-[4px] w-10 rounded-md" alt="Photo">
                                                <span class="primaryTxt text-sm font-semibold">{{getFileName(request.fileLink)}}</span>
                                            </div> 
                                            <div *ngIf="request.link" class="secondaryTxt text-sm font-semibold">        
                                                <a [href]="request.link" class="border-b border-[#089B41] hover:text-[#089b408c]"
                                                    target="_blank" (click)="$event.stopPropagation();"
                                                    rel="noopener"> <!-- Prevents the new tab from having access to the original page via window.opener -->
                                                    View Link
                                                </a>                                    
                                            </div> 
                                        </div>
                                        <p class="text-[#BDBDBD] text-sm font-semibold mt-2">{{ formatInsertedAt(request.insertedAt) }}</p>
                                    </div>
                                </div>
                            </div> 
                        </li>
                        <li *ngIf="requests.length == 0"> 
                            <div class="flex justify-center">
                                <p class="text-[#BDBDBD]">No Requests Yet</p>
                            </div>  
                        </li>
                    </ul> 
                </div>
            </div>
            <div class="relative dropdown-container">  
                <div class="relative cursor-pointer hover:opacity-80 hover:scale-110 transition-all" (click)="toggleNotificationPopup()" >
                    <i class="fa-regular fa-bell text-white text-3xl"></i> 
                    <span *ngIf="notificationsUnSeenCount > 0"
                        class="primaryBg absolute -top-2 -right-2 border-2 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold" >
                        {{ notificationsUnSeenCount }}
                    </span>
                </div>
                <div *ngIf="isNotificationPopupOpen" class="absolute ltr:right-0 rtl:left-0 mt-2 w-[440px] bg-white shadow-lg z-50">
                    <div class="flex justify-between space-x-3 rtl:space-x-reverse p-4">
                        <h3 class="primaryTxt font-semibold">Notifications</h3>
                        <button (click)="viewAllNotifications()" class="text-gray-500 text-sm hover:text-gray-700 transition">View All <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                    <ul>
                        <li *ngFor="let notification of notifications; let i = index" class="relative" (click)="viewNotification(notification)">
                             <div *ngIf="!notification.seenOrNot"
                                class="absolute top-2 left-2 w-2.5 h-2.5 border border-[#4d8db4] bg-[#8ccff8b6] rounded-full z-10">
                            </div>
                            <div class="flex hover:bg-gray-100 p-3 items-start" [ngClass]="{'border-b': i != notifications.length, 'bg-[#e3ebf0b6]': !notification.seenOrNot}">
                                <div class="flex-shrink-0">
                                    <img src="Images/person-dummy.jpg" class="cursor-pointer rounded-full w-14" alt="Profile Photo">
                                </div>
                                <div class="ml-4 text-start w-full"> 
                                    <p class="primaryTxt text-sm"><span class="font-semibold">{{ notification.insertedByUserName }}</span> Notifed You</p>
                                    <div class="mt-4 flex flex-col space-y-3">
                                        <div *ngIf="notification.text" class="w-[70%] border-l-4 border-gray-300 pl-4 primaryTxt text-base leading-relaxed truncate overflow-hidden whitespace-nowrap">
                                            {{notification.text}}
                                        </div> 
                                        <div *ngIf="notification.imageLink" class="flex space-x-2 items-center">
                                            <img src="Images/Icon frame.png" class="border p-[4px] w-10 rounded-md" alt="Photo">
                                            <span class="primaryTxt text-sm font-semibold">{{getFileName(notification.imageLink)}}</span>
                                        </div> 
                                        <div *ngIf="notification.link" class="secondaryTxt text-sm font-semibold">        
                                            <a [href]="notification.link" class="border-b border-[#089B41] hover:text-[#089b408c]"
                                                target="_blank" (click)="$event.stopPropagation(); LinkOpened(notification)"
                                                rel="noopener"> <!-- Prevents the new tab from having access to the original page via window.opener -->
                                                View Link
                                            </a>                                    
                                        </div> 
                                    </div>
                                    <p class="text-[#BDBDBD] text-sm font-semibold mt-2">{{ formatInsertedAt(notification.insertedAt) }}</p>
                                </div>
                            </div>
                        </li>
                        <li *ngIf="notifications.length == 0"> 
                            <div class="flex justify-center">
                                <p class="text-[#BDBDBD]">No Notifications Yet</p>
                            </div>  
                        </li>
                    </ul> 
                </div>
            </div>
        </div>
        <div class="flex items-center justify-between space-x-3 rtl:space-x-reverse">
            <div>
                <i class="fa-solid fa-globe text-white text-2xl"></i>
            </div>
            <div class="relative">
                <button class="lg:flex items-center lg:space-x-2 rtl:space-x-reverse font-semibold text-white"
                    (click)="toggleDropdown()">
                    <p class="hidden lg:block">{{ selectedLanguage }}</p>
                    <i class="fa-solid fa-caret-down"></i>
                </button>
                <div *ngIf="dropdownOpen" class="absolute mt-2 w-32 bg-white text-gray-700 rounded-md shadow-lg z-50">
                    <a class="block px-4 py-2 hover:bg-gray-200" (click)="selectLanguage('en')">English</a>
                    <a class="block px-4 py-2 hover:bg-gray-200" (click)="selectLanguage('ar')">العربية</a>
                </div>
            </div>
        </div>
        <div>
            <div class="relative dropdown-container">
                <div class="flex items-center justify-between space-x-3 rtl:space-x-reverse" (click)="togglePopup()">
                    <img src="Images/person-dummy.jpg" class="cursor-pointer rounded-full w-14" alt="Profile Photo">
                    <div class="hidden font-semibold text-white lg:flex flex-col space-y-2">
                        <div class="text-xl">
                            {{userName}}
                        </div>
                        <div class="text-sm">
                            {{ User_Type.charAt(0).toUpperCase() + User_Type.slice(1).toLowerCase() }}
                        </div>
                    </div>
                </div>
                <div *ngIf="isPopupOpen"
                    class="absolute ltr:right-0 rtl:left-0 mt-2 w-60 max-w-xs bg-white rounded-lg shadow-lg p-4 z-50">
                    <h3 class="font-semibold text-gray-700">Account Options</h3>
                    <ul class="mt-2">
                        <li *ngFor="let token of allTokens">
                            <button (click)="ChangeAccount(token.id)" [ngClass]="{'border bg-gray-100':token.key == userName && token.UserType == User_Type}"
                                class="text-start w-full hover:bg-gray-100 p-2 rounded-md"> 
                                <p class="primaryTxt">{{ token.key }}</p>
                                <p class="text-gray-500 text-xs">{{ token.UserType }}</p>
                            </button>
                        </li>
                    </ul>
                    <button (click)="openModal()" class="text-start w-full hover:bg-gray-100 p-2 rounded-md">Change Password</button>
                    <button (click)="gotologin()" class="text-start w-full hover:bg-gray-100 p-2 rounded-md">Add New
                        Account</button>
                    <button (click)="logOut()" class="text-start w-full hover:bg-gray-100 p-2 rounded-md">Log
                        Out</button>
                    <button (click)="logOutAll()" class="text-start w-full hover:bg-gray-100 p-2 rounded-md">Log Out
                        From All Accounts</button>

                </div>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div id="ChangePassModal" class="fixed inset-0 z-50 justify-center items-center w-full h-full bg-black/50 hidden">
    <div class="bg-white rounded-2xl px-12 py-9 w-1/3">
        <div class="flex justify-between items-center">
            <h1 class="font-semibold text-2xl leading-9">Change Password</h1> 
            <button (click)="closeModal()" type="button" class="text-gray-500 hover:text-gray-600 font-bold text-xl">X</button>
        </div>

        <div class="mt-6 flex flex-wrap justify-between mb-4">
            <div class="flex flex-col w-full mb-4"> 
                <label class="primaryTxt mb-2 font-medium" for="OldPassword">Old Password</label>
                <input id="OldPassword" type="password" class="rounded-lg border border-solid border-gray-300 px-4 py-3" placeholder="Enter Old password"
                (input)="onoldPasswordChange()" autocomplete="new-password" [(ngModel)]="editpasss.oldPassword"/> 
                <span *ngIf="OldPasswordError" class="text-red-500 text-sm font-normal">{{ OldPasswordError }}</span>
            </div> 
            <div class="flex flex-col w-full mb-4"> 
                <label class="primaryTxt mb-2 font-medium" for="Password">Password</label>
                <input id="Password" type="password" autocomplete="new-password" class="rounded-lg border border-solid border-gray-300 px-4 py-3" placeholder="Enter the password"
                (input)="onPasswordChange()" [(ngModel)]="password"/>
                <span *ngIf="PasswordError" class="text-red-500 text-sm font-normal">{{ PasswordError }}</span>
            </div> 
            <div class="flex flex-col w-full mb-4"> 
                <label class="primaryTxt mb-2 font-medium" for="confirmPassword">Confirm Password</label>
                <input id="confirmPassword" type="password" autocomplete="new-password" class="rounded-lg border border-solid border-gray-300 px-4 py-3" placeholder="Enter the password Again"
                [(ngModel)]="confirmPassword"/> 
            </div> 
        </div> 
        <div class="flex justify-end">
            <button  
                [disabled]="isLoading" 
                class="secondaryBg text-white font-medium px-4 py-2 rounded-lg" 
                (click)="Save()">
                <span *ngIf="!isLoading">Save</span>
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
              </button>
        </div>
    </div>
</div>


<!-- NotificationModal -->
<div id="NotificationModal" class="fixed inset-0 z-50 justify-center items-center w-full h-full bg-black/50 hidden overflow-x-hide">
    <div class="bg-white rounded-2xl p-5 w-1/3 max-h-[75vh] overflow-y-auto overflow-x-hide"> 
        <div class="flex justify-end">  
            <button (click)="closeNotificationModal()" type="button" class="text-gray-500 hover:text-gray-600 font-bold text-xl">X</button>
        </div>
        <div class="flex p-3 items-start max-w-full overflow-y-auto overflow-x-hide">
            <div class="flex-shrink-0">
                <img src="Images/person-dummy.jpg" class="cursor-pointer rounded-full w-14" alt="Profile Photo">
            </div>
            <div class="ml-4 text-start"> 
                <p class="primaryTxt text-sm"><span class="font-semibold">{{ notificationByID.insertedByUserName }}</span> Notifed You</p>
                <div class="mt-4 flex flex-col space-y-3 ">
                    <div *ngIf="notificationByID.imageLink" class="flex space-x-2 items-center"> 
                        <img [src]="notificationByID.imageLink" class="w-[200px] object-cover rounded-md"> 
                    </div> 
                    <div *ngIf="notificationByID.link" class="secondaryTxt text-sm font-semibold">        
                        <a [href]="notificationByID.link" class="border-b border-[#089B41] hover:text-[#089b408c]"
                        target="_blank" (click)="LinkOpened(notificationByID)"
                        rel="noopener"> <!-- Prevents the new tab from having access to the original page via window.opener -->
                        View Link
                        </a>                                    
                    </div> 
                    <div *ngIf="notificationByID.text" class="w-full border-l-4 border-gray-300 pl-4 primaryTxt text-base">
                        <p class="break-words">
                            {{notificationByID.text}}
                        </p>
                    </div> 
                </div>
                <p class="text-[#BDBDBD] text-sm font-semibold mt-2">{{ formatInsertedAt(notificationByID.insertedAt) }}</p>
            </div>
        </div>
    </div>
</div>
